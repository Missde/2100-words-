<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="icon" href="data:;base64,iVBORw0KGgo=">
	<meta name="author" content="MissdeÊï¥ÁêÜÔºö‚ë†ËØçÈ¢ëÂàóË°®ÂèñËá™Ëù∂ÂèòËÉåÂçïËØç„ÄÇ‚ë°‰æãÂè•„ÄÅ‰ΩúÊñáÁî±Ë±ÜÂåÖ+DeepSeekÁîüÊàê„ÄÇ‚ë¢‰ΩúÊñáÊúóËØªÔºöÂæÆËΩØËØ≠Èü≥Â∫ì"/>
	<title>Âàù‰∏≠2100ÂçïËØç</title>
	<style>
		h1 {margin:0 0 15px 0;padding:0; text-align: center; /* Fixed positioning for floating effect */ position: fixed; top: 0; left: 0; right: 0; background-color: white; /* Ensure background */ z-index: 1001; /* Ensure it's on top */ box-shadow: 0 2px 4px rgba(0,0,0,0.1); /* Optional shadow for better visibility */ }

		h1 a { display: inline-block;padding: 3px 13px;margin: 0 5px;background-color: #f5f5f5;color: #333;text-decoration: none;border-radius: 20px;border: 1px solid #ddd;font-size: 1.1rem;transition: all 0.2s ease;}
		h1 a:first{padding-left:0;}
		h1 a:last{padding-right:0;}
		h1 a:hover { color: #1976d2;background-color: #e3f2fd;border-color: #2196F3;}
		h1 a.active {background-color: #2196F3;color: white;border-color: #1976d2;font-weight: bold;}
		body {font-family: Arial, sans-serif;line-height: 1.6;max-width: 1000px;margin: 0 auto;padding: 80px 0 20px 0px; /* Adjusted top padding to account for fixed h1 */ font-family:"ËàíÁ™àË°°Ê∞¥‰Ωìshuyaohengshuiti";} /* Added padding-top */
		.controls {display: flex;justify-content: space-between;align-items: center;margin-bottom: 10px;flex-wrap: wrap;gap: 15px;}
		.search-box {display: flex;gap: 10px;flex: 1;min-width: 250px;}
		#searchInput {flex: 1;padding: 8px 12px;border: 1px solid #ddd;border-radius: 4px;font-size: 1rem;}
		.search-box .checkbox{border:1px solid #ddd;border-radius: 4px;padding:0 4px;line-height:40px;font-size: .8rem;}
		#fuzzySearch {width: 18px;height: 18px;vertical-align: sub;}
		.sort-btn {padding: 8px 16px;background-color: #2196F3;color: white;border: none;border-radius: 4px;cursor: pointer;transition: background-color 0.3s;}
		.sort-btn:hover {background-color: #0b7dda;}
		.word-card {border: 1px solid #ddd;border-radius: 8px;padding: 5px 15px;margin-bottom: 10px;box-shadow: 0 2px 4px rgba(0,0,0,0.1);position: relative;width: calc(50% - 10px);display: inline-block;vertical-align: top;box-sizing: border-box;height:110px;overflow:hidden;}
		.word-card:nth-child(odd) {margin-right: 10px;clear:both;}
		.word-card:nth-child(even) {margin-left: 10px;float:right;}
		.word-card.forget {background-color: #fff8f8; border-left: 4px solid #ff6b6b;}
		.word-card.learned {background-color: #FCFFFC; border-left: 4px solid #4caf50;}
		.word-header {display: flex;justify-content: space-between;align-items: flex-start;margin-bottom: 10px;}
		.word-main {height: 40px;overflow: hidden;line-height:40px;flex: 1;}
		.word {font-size: 2rem;font-weight: bold;margin-right:0px;cursor: pointer;padding-left:3px;}
		.phonetic {color: #666;font-style: italic;margin: 0 5px 0 0;cursor: pointer;font-size: 0.7rem;font-family:"ÂæÆËΩØÈõÖÈªë";}
		.explanation {color: #333;font-size: 0.8rem;}
		.explanation.verb-link {cursor: pointer; color: #1976d2;}
		.explanation.verb-link:hover {text-decoration: underline;}
		.explanation i{color:#bbb;}
		.explanation i:before{content:"(";margin-left:3px;}
		.explanation i:after{content:")";margin-right:3px;}
		.audio-btn {text-indent:5px;font-size:1.3rem;color: white;border: none;border-radius: 50%;width: 40px;height: 40px;cursor: pointer;display: flex;align-items: center;justify-content: center;transition: background-color 0.3s;}
		.audio-btn.playing {background-color: #2196F3;}
		.example {border-top: 1px dashed #eee;}
		.example-english {transition: all 0.3s ease;}
		.example-english:hover {color: #1976d2;}
		.example-chinese{color:#aaa;font-size:.8rem;}
		.pagination {display:block;text-align: center;margin-top: 30px;gap: 10px;flex-wrap: wrap;clear:both;}
		.pagination.hide{display:none;}
		.page-btn {overflow:hidden;margin-right:10px;padding: 8px 16px;border: 1px solid #ddd;border-radius: 4px;background-color: white;cursor: pointer;transition: all 0.2s;}
		.page-btn.active {background-color: #2196F3;color: white;border-color: #2196F3;}
		.page-btn:disabled {opacity: 0.5;cursor: not-allowed;}
		.page-btn:hover:not(.active):not(:disabled) {border-color: #2196F3;color: #2196F3;}
		.ellipsis {align-items: center;padding: 0 8px;color: #666;}
		.word-page {display: none;}
		.word-page.active {display: block;}
		.no-results {text-align: center;padding: 40px;color: #666;font-size: 1.2rem;}
		.highlight {color: red;}
		.word-index {text-decoration: none;position: absolute; bottom:10px; right:20px; color: #999; font-size: 0.9rem;border:1px solid #ddd;padding:3px;line-height:17px;height:17px;min-width:17px;text-align:center;border-radius:50%;}
		.word-index.high-frequency { border-color: #ff4444; background-color: #ffebee; color: #c62828;}
		.word-index.medium-frequency { border-color: #ff9800; background-color: #fff3e0; color: #ef6c00;}
		.word-index.low-frequency { border-color: #4caf50; background-color: #e8f5e8; color: #2e7d32;}
		.print-footer {display: none;}
		.toast-container {position: fixed;top: 20px;right: 20px;z-index: 1000;max-width: 300px;}
		.toast {background: #333;color: white;padding: 12px 16px;margin-bottom: 10px;border-radius: 4px;box-shadow: 0 4px 12px rgba(0,0,0,0.15);transform: translateX(100%);opacity: 0;transition: all 0.3s ease;cursor: pointer;}
		.toast.show {transform: translateX(0);opacity: 1;}
		.toast.hide {transform: translateX(100%);opacity: 0;}
		.toast.success {background: #4caf50;}
		.toast.warning {background: #ff9800;}
		.toast.info {background: #2196F3;}
		.toast.error {background: #f44336;}
		/* Âä®ËØçËØ¶ÊÉÖÊºÇÊµÆÂ±ÇÊ†∑Âºè */
		.verb-modal-overlay{position: fixed;top: 0;left: 0;right: 0;bottom: 0;background-color: rgba(0, 0, 0, 0.5);display: flex;justify-content: center;align-items: center;z-index: 2000;opacity: 0;visibility: hidden;transition: all 0.3s ease;}
		.verb-modal-overlay.active{opacity: 1;visibility: visible;}
		.verb-modal{background-color: white;border-radius: 12px;box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);width: 90%;max-width: 600px;max-height: 80vh;overflow-y: auto;transform: scale(0.9);transition: transform 0.3s ease;position: relative;}
		.verb-modal-header{background: linear-gradient(135deg, #2196F3, #1976d2);color: white;padding:5px 20px;border-radius: 12px 12px 0 0;display: flex;justify-content: space-between;align-items: center;}
		.verb-modal-title{font-size: 2rem;font-weight: bold;margin: 0;}
		.verb-modal-close{background: none;border: none;color: white;font-size: 1.5rem;cursor: pointer;width: 36px;height: 36px;border-radius: 50%;display: flex;align-items: center;justify-content: center;transition: background-color 0.2s;}
		.verb-modal-close:hover{background-color: rgba(255, 255, 255, 0.2);}
		.verb-modal-content{padding: 10px;}
		.verb-form-grid{display: grid;grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));gap: 10px;}
		.verb-form-item{background-color: #f8f9fa;border-radius: 8px;padding: 5px;text-align: center;transition: all 0.2s;border: 1px solid #e9ecef;}
		.verb-form-item:hover{background-color: #e9ecef;transform: translateY(-2px);box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);}

		.verb-form-item.play .verb-form-value:before{content:"üîä";font-size:.8rem;}

		.verb-form-label{font-size: 1rem;color: #666;text-transform: uppercase;font-weight: bold;}
		.verb-form-value{font-size: 1.3rem;font-weight: bold;color: #2196F3;}
		.verb-examples{margin:20px 0;}
		.verb-example-type{margin-bottom: 15px;}
		.verb-example-type-title{font-size: 1rem;font-weight: bold;color: #555;padding-left: 10px;border-left: 5px solid #2196F3;}
		.verb-example-list{list-style-type: none;padding-left: 0;margin:0;padding:0;}
		.verb-example-item{font-size:1.2rem;transition: all 0.2s;padding: 5px 10px;margin-left:30px;margin-bottom: 5px;background-color: #f8f9fa;border-radius: 6px;border-left: 3px solid #4caf50;cursor: pointer;}
		.verb-example-item:hover{background-color: #e9ecef;}
		.verb-example-item:nth-child(odd){background-color: #f0f4f8;}
		.reading-ing {background: #2196F3;color:#1976d2;transition: all 0.3s ease;}
		.example-english.reading-ing {background:#e3f2fd;padding:0px 6px;border-radius: 4px;}
		.verb-example-item.reading-ing {background:#e3f2fd;border-left-color: #2196F3;transform: translateX(5px);font-size:1.3rem;}
		.read-sentence.reading-ing {background:#e3f2fd;color: #1976d2;border:#2196F3;transform:scale(1.02);}
		/* ÂæÖÂ≠¶ÂçïÂÖÉÈÄâÊã©Âô®Ê†∑Âºè */
		.unit-selector { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 10px;padding-left:2rem;}
		.unit-selector label {transition: all 0.2s;display: inline-flex; align-items: center; cursor: pointer;color:#0078d7;background: #eef7ff;border: 1px solid #a0cfff; padding:2px 10px;border-radius: 15px;font-size: 0.9rem; }
		.unit-selector label:hover{background:#fff;}
		.unit-selector input[type="checkbox"] {transition: all 0.2s;margin-right: 5px;appearance: none;border:1px solid #a0cfff;width:13px;height:13px;border-radius:50%;}
		.unit-selector input[type="checkbox"]:checked {background: #fff;border-color: #007bff;}
		.unit-selector label.on{background: #2196F3;color:#fff;}
		#cachediv{border:3px solid #eee;padding:10px;border-radius:10px;width:100%;}
		#unitSelectorContainer{border:3px solid #eee;1padding:10px;border-radius:10px;margin-bottom:20px;}
		#unitSelectorContainer:before{content:"ÊâπÈáèÊ†áÊ≥®Â∑≤Â≠¶ÁöÑÂçïËØç";display:block;background:#eee;padding:5px 10px;border-radius:3px;margin-bottom:10px;}
		/* ÂàÜÁ±ªÈÄâÊã©Âô®Ê†∑Âºè */
		.group-selector { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 10px; padding-left:10px; }
		.group-selector label { display: inline-flex; align-items: center; cursor: pointer;padding:3px 10px; border-radius: 15px;font-size: 0.9rem;transition: all 0.2s;color:#0078d7;background: #eef7ff;border: 1px solid #a0cfff;}
		.group-selector label:hover{background-color: #2196F3;color: #fff;}
		.group-category-header {margin: 10px 0 5px 10px;clear: both; width: 100%; }
		.group-category-h2:before{content:"Âπ¥Á∫ßÂàÜÁ±ª";display:block;background:#eee;padding:5px 10px;border-radius:3px;margin:20px 0;}
		#groupSelectorContainer:before{content:"ÂçïËØçÂàÜÁ±ª";display:block;background:#eee;padding:5px 10px;border-radius:3px;margin-bottom:10px;}
		/* ‰ΩúÊñáÂÜÖÂÆπÂ±ÇÊ†∑Âºè */
		.essay-panel.show {display: block;}
		.essay-panel {position: fixed;left: 50%;bottom:10px;transform: translateX(-50%);width: calc(100% - 20px);max-width:900px;background: white;border: 2px solid #2196F3;border-radius: 12px;box-shadow: 0 -8px 25px rgba(0, 0, 0, 0.15);z-index: 1000;overflow: hidden;display: none;padding-bottom:10px;transition: all 0.3s ease;}
		/* ‰ΩúÊñáÈü≥È¢ëÊéßÂà∂Ê†∑Âºè */
		.essay-audio-controls {display: none;background: linear-gradient(135deg, #2196F3, #1976d2);padding: 8px 15px;border-bottom: 1px solid #1976d2;}
		.audio-controls-container {display: flex;align-items: center;gap: 12px;max-width: 100%;}
		.audio-play-btn,
		.tts-play-btn {background:#1976d2;border: none;border-radius: 50%;width: 32px;height: 32px;cursor: pointer;display: flex;align-items: center;justify-content: center;font-size: 12px;color: #fff;transition: all 0.2s ease;}
		.audio-play-btn:hover,
		.tts-play-btn:hover {background: #fff;color:#1976d2;transform: scale(1.05);}
		.audio-play-btn.playing,
		.tts-play-btn.playing {background: #fff;color:#1976d2;}
		.audio-progress {flex: 1;height: 6px;border-radius: 3px;background: rgba(255, 255, 255, 0.3);outline: none;-webkit-appearance: none;}
		.audio-progress::-webkit-slider-thumb {-webkit-appearance: none;width: 16px;height: 16px;border-radius: 50%;background: white;cursor: pointer;border: 2px solid #1976d2;}
		.audio-progress::-moz-range-thumb {width: 16px;height: 16px;border-radius: 50%;background: white;cursor: pointer;border: 2px solid #1976d2;}
		.audio-time {color: white;font-size: 0.8rem;min-width: 90px;text-align: center;font-family: monospace;}
		.essay-header {background: linear-gradient(135deg, #2196F3, #1976d2);color: white;padding: 12px 8px;font-weight: bold;font-size: 1rem;display: flex;justify-content: space-between;align-items: center;}
		.essay-header:before{content:"essay by AI";position:absolute;right:40px;color:#ddd;}
		.essay-header-title {display: flex;align-items: center;flex: 1;}
		.essay-header-controls {display: flex;align-items: center;gap: 5px;}
		.essay-expand-btn {background: none;border: none;color: white;font-size: 1.1rem;cursor: pointer;width: 28px;height: 28px;border-radius: 50%;display: flex;align-items: center;justify-content: center;transition: background-color 0.2s;margin-left: 8px;}
		.essay-expand-btn:hover {background-color: rgba(255, 255, 255, 0.2);}
		.essay-close {background: none;border: none;color: white;font-size: 1.3rem;cursor: pointer;width: 28px;height: 28px;border-radius: 50%;display: flex;align-items: center;justify-content: center;transition: background-color 0.2s;}
		.essay-close:hover {background-color: rgba(255, 255, 255, 0.2);}
		.essay-content {padding: 5px;max-height: calc(10vh - 60px);overflow-y: auto;font-size: 1.1rem;line-height: 1.4;white-space: pre-line;word-wrap: break-word;transition: max-height 0.3s ease;}
		.essay-content p {margin: 0;padding: 0 0 10px 0;text-indent: 15px;line-height: 1.4;}
		.essay-content .highlight {font-weight: 400;color: #2196F3;}
		/* ÂÜÖÂÆπÂå∫ÂüüÈ´òÂ∫¶Ë∞ÉÊï¥ */
		.essay-panel{max-height: 10vh;}
		.essay-panel.big {max-height: 60vh;}
		.essay-panel.show.has-audio .essay-content {max-height: calc(10vh - 30px);}
		.essay-panel.big.show .essay-content {max-height: calc(60vh - 60px);}
		.essay-panel.big.show.has-audio .essay-content {max-height: calc(60vh - 30px);}
		.essay-panel.show.has-tts .essay-content {max-height: calc(10vh - 30px);}
		.essay-panel.big.show.has-tts .essay-content {max-height: calc(60vh - 30px);}
		body.essay-panel-visible {padding-bottom: calc(15vh);transition: padding-bottom 0.3s ease;}
		body.essay-panel-visible.big {padding-bottom: calc(50vh);}
		.no-tts .verb-example-item{cursor:text}
		.no-tts .read{display:none;}


		/* ÊúóËØªÈù¢Êùø */
		.readPanel{display:none;border-radius:12px; margin:20px auto; max-width:1000px;}
		.readPanel .textarea{margin-bottom:20px;}
		.readPanel textarea{background:#fafcff;width:97%; height:120px;margin:0 auto;padding:12px; border:2px solid #ccc; border-radius:8px; font-size:0.9rem; resize:vertical;}
		.readPanel .fenduan{display:none;margin-top: 12px;margin-bottom: 20px;padding: 14px;background: #fafcff;border: 2px solid #e0e6f0;border-radius: 10px;line-height: 1.8;font-size: 17px;min-height: 60px;}
		.readPanel .read-sentence {display: inline-block;padding: 0px 8px;margin: 2px 4px 2px 0;border-radius: 6px;cursor: pointer;transition: all 0.2s;background-color: #ffffff;border: 1px solid #e8eef7;}
		.readPanel .read-sentence:hover {background-color: #eef7ff;color: #0078d7;border-color: #a0cfff;}
		.readPanel .read-sentence.playing {background-color: #d0e7ff;border-color: #0078d7;}
		.readPanel .set{background:#fff8f8; padding:15px; border-radius:8px; margin:20px 0; border:1px solid #ffe0e0;}
		.readPanel .set h3{margin-top:0; color:#d32f2f; font-size:1.1rem;}
		.readPanel .set label{font-weight:bold; margin-right:8px;}
		.readPanel .set input{width:100px;}
		.readPanel .set span{font-size:0.9rem; color:#555; min-width:40px; display:inline-block;}
		.readPanel .set select{padding:6px 10px; border-radius:4px; border:1px solid #ccc;width:300px}
		.readPanel .setbox{display:flex; flex-wrap:wrap; gap:15px; align-items:center;}

		/* ÁßªÂä®Á´ØÂìçÂ∫îÂºèÊ†∑Âºè */
		@media screen and (max-width: 600px) {
			body {padding: 0 10px 20px;font-size: 14px;}
			h1 {margin:10px 0 0 0;line-height:20px;}
			h1 a {display: inline-block;margin:0px;padding:0 6px;font-size: 0.9rem;font-weight:400;}
			.controls {flex-direction: column;align-items: stretch;gap: 10px;}
			.search-box .checkbox{width:40px;line-height:20px;}
			.sort-btn{padding:0 5px;}
			.unit-selector { justify-content: center; }
			.group-selector { justify-content: center; }
			.word-card {width: 100%;display: block;margin: 0 0 10px 0 !important;height: auto;min-height: 110px;}
			.word-card:nth-child(odd),.word-card:nth-child(even) {margin: 0 0 10px 0;float: none;clear: both;}
			.word-header {flex-direction: column;align-items: flex-start;margin-bottom:0;}
			.word-main {height: auto;line-height: 1.4;margin-bottom: 5px;width: 100%;}
			.word {font-size: 1.5rem;display: inline-block;margin-right: 10px;}
			.phonetic {font-size: 0.8rem;display: inline-block;}
			.explanation {margin-top: 5px;font-size: 0.8rem;}
			.audio-btn {align-self: flex-end;position: absolute;top: 10px;right: 15px;width:30px;height:30px;}
			.example {margin-top: 5px;padding-top: 5px;}
			.example-english {font-size: 0.9rem;}
			.example-chinese {font-size: 0.8rem;}
			.word-index {bottom: 10px;right: 15px;min-width:13px;height:13px;line-height:13px;font-size:.7rem;}
			.pagination {gap: 5px;margin-top: 20px;}
			.page-btn {padding: 6px 12px;font-size: 0.9rem;}
			.toast-container {top: 10px;right: 10px;left: 10px;max-width: none;}
			.verb-modal {width: 95%;margin: 20px 10px;}
			.verb-modal-title {font-size: 1.5rem;}
			.verb-form-grid {grid-template-columns: 1fr 1fr;gap: 8px;}
			.verb-form-item {padding: 8px 5px;}
			.verb-form-label {font-size: 0.8rem;}
			.verb-form-value {font-size: 1rem;}
			.verb-example-item {margin-left: 10px;font-size: 0.9rem;}
			/* ÁßªÂä®Á´Ø‰ΩúÊñáÈù¢ÊùøË∞ÉÊï¥ */
			.essay-audio-controls {padding: 6px 10px;}
			.audio-controls-container {gap: 8px;}
			.audio-play-btn,
			.tts-play-btn {width: 28px;height: 28px;font-size: 10px;}
			.audio-time {font-size: 0.7rem;min-width: 75px;}
			.essay-panel.big .essay-content {max-height: calc(60vh - 80px);}
			.essay-panel.big.show.has-audio .essay-content {max-height: calc(60vh - 120px);}
			.essay-panel.big.show.has-tts .essay-content {max-height: calc(60vh - 120px);}
		}

			.en0:before,.cn0:before{content:"‚ë†";color:#ccc;font-size:.7rem;}
			.en1:before,.cn1:before{content:"‚ë°";color:#ccc;font-size:.7rem;}
			.en2:before,.cn2:before{content:"‚ë¢";color:#ccc;font-size:.7rem;}



		@media print {
			.essay-panel.show,
			h1,.controls,.audio-btn,.pagination,.essay-panel,.toast-container{display:none}
			body{font-size:1rem;padding:20px;}
			.highlight {color:#000;}
			.word-main{height:30px;line-height:30px;}
			.word,.word *{font-size: 1.4rem;color:#f00;}
			.word-header,.example{margin:0;padding:0;}
			.word-card{box-shadow:none;margin:0 0 3px 0;padding:2px 5px;position: relative;height:92px;overflow:hidden;}
			.word-index {position: absolute; top: 5px; right: 5px;bottom:auto;left:auto;color:#666;font-size: 0.7rem;border:none;}
			.print-footer {display: block;position: fixed;bottom: 10px;right: 10px;font-size: 0.8rem;color: #666;}
			.example-english{font-size:1rem;margin:0;padding:0;line-height:18px;-display:block;}
			.chinesebox{display:inline-block;}
			.word-card.forget,.word-card.learned {border-left-width:2px;}
			body.essay-panel-visible {padding:0;}
			body.essay-panel-visible.big {padding:0;}
		}
	</style>
</head>
<body>
	<h1>
		<a href="?filter=all" class="active">‰∏≠ËÄÉÂçïËØç</a>
		<a href="?filter=high">È´òÈ¢ë</a>
		<a href="?filter=medium">‰∏≠È¢ë</a>
		<a href="?filter=low">‰ΩéÈ¢ë</a>
		<a href="?filter=learned">Â∑≤Â≠¶</a>
		<a href="?filter=no">Êú™Â≠¶</a>
		<a href="?filter=forgotten">ÂøòÁöÑ</a>
		<a href="?filter=random">ÈöèÊú∫Â§ç‰π†</a>
		<a href="?filter=group">ÂàÜÁ±ª</a>
		<a href="?filter=read" class="read">ÊúóËØª</a>
		<a href="?filter=cache">ËÆæÁΩÆ</a>
	</h1>
	<div class="controls">
		<div class="search-box">
			<label class="checkbox">
				<input type="checkbox" id="fuzzySearch" checked><span>ÂÖ®ÊñáÊêúÁ¥¢</span>
			</label>
			<input type="text" lang="en" inputmode="latin" id="searchInput" placeholder="ÊêúÊ±âÂ≠ó„ÄÅÂè•Â≠êÔºåÂ§ö‰∏™ÂçïËØç(yes,no,not)" autocomplete="off">
			<button class="sort-btn" id="sortBtn">ÊåâÂ≠óÊØçÊéíÂ∫è</button>
		</div>
	</div>
	<div id="unitSelectorContainer" style="display: none;"></div>
	<div id="wordContainer"></div>
	<!-- ÊúóËØªÂäüËÉΩÈù¢Êùø -->
	<div id="readPanel" class="readPanel">
		<div class="textarea">
			<textarea id="readInput" placeholder="ËØ∑ËæìÂÖ•Ë¶ÅÊúóËØªÁöÑËã±ÊñáÊàñ‰∏≠ÊñáÊñáÊú¨ÔºàÊîØÊåÅÂ§öÊÆµ„ÄÅÂ§öÂè•Ôºâ..."></textarea>
		</div>
		<div id="sentenceOutput" class="fenduan"></div>
		<div style="text-align:center;">
			<button id="readAllBtn" class="sort-btn" style="margin-right:10px;">üîä ÊúóËØªÂÖ®Êñá</button>
			<button id="pauseBtn" class="sort-btn">‚è∏ ÊöÇÂÅú</button>
		</div>
		<div class="set">
			<h3>‚öôÔ∏è ÊúóËØªËÆæÁΩÆ</h3>
			<div class="setbox">
				<div>
					<label style="">Èü≥Ëâ≤:</label>
					<select id="voiceSelect"></select>
				</div>
				<div>
					<label>ËØ≠ÈÄü:</label>
					<input type="range" id="rateSlider" min="0.5" max="2" step="0.1" value="0.9">
					<span id="rateValue">0.9</span>
				</div>
				<div>
					<label>Èü≥Ë∞É:</label>
					<input type="range" id="pitchSlider" min="0.5" max="2" step="0.1" value="1.0">
					<span id="pitchValue">1.0</span>
				</div>
			</div>
		</div>
	</div>
	<div class="pagination" id="pagination"></div>
	<div class="print-footer" id="printFooter"></div>
	<div class="toast-container" id="toastContainer"></div>
	<div class="essay-panel" id="essayPanel">
		<div class="essay-audio-controls" id="essayAudioControls">
			<div class="audio-controls-container">
				<!-- Èü≥È¢ëÊí≠ÊîæÊåâÈíÆ -->
				<button class="audio-play-btn" id="essayAudioPlay">‚ñ∂</button>
				<!-- TTS ÊúóËØªÊåâÈíÆ -->
				<button class="tts-play-btn" id="essayTTSPlay" style="display:none;">‚ñ∂</button>
				<input type="range" class="audio-progress" id="essayAudioProgress" min="0" max="100" value="0">
				<span class="audio-time" id="essayAudioTime">00:00 / 00:00</span>
			</div>
		</div>
		<div class="essay-header">
			<div class="essay-header-title">
				<span id="essayTitle">‰ΩúÊñáÊ†áÈ¢ò</span>
			</div>
			<div class="essay-header-controls">
				<button class="essay-expand-btn" id="essayExpandBtn" title="Êâ©Â§ßÈù¢Êùø">‚õ∂</button>
				<!--<button class="essay-close" id="essayClose">&times;</button>-->
			</div>
		</div>
		<div class="essay-content" id="essayContent"></div>
	</div>
	<!-- Âä®ËØçËØ¶ÊÉÖÊºÇÊµÆÂ±Ç -->
	<div class="verb-modal-overlay" id="verbModalOverlay">
		<div class="verb-modal">
			<div class="verb-modal-header">
				<h2 class="verb-modal-title" id="verbModalTitle">Âä®ËØçËØ¶ÊÉÖ</h2>
				<button class="verb-modal-close" id="verbModalClose">&times;</button>
			</div>
			<div class="verb-modal-content" id="verbModalContent">
			</div>
		</div>
	</div>
	<script src="db.js"></script>
	<script>

		class SpeechManager {
			constructor() {
				this.synth = window.speechSynthesis;
				this.currentUtterance = null;
				this.isSpeaking = false;
				this.currentVoice = null;
			}
			setVoice(voiceName) {
				const voices = this.synth.getVoices();
				const selectedVoice = voices.find(voice =>
					voice.name === voiceName ||
					voice.name.includes(voiceName)
				);
				this.currentVoice = selectedVoice || voices.find(voice => voice.lang.startsWith('en-')) || voices[0];
			}
			speak(text, rate = 0.9, pitch = 1.0, volume = 1.0) {
				console.log(text);
				this.stop();
				return new Promise((resolve, reject) => {
					try {
						this.currentUtterance = new SpeechSynthesisUtterance(text);
						this.currentUtterance.lang = 'en-US';
						this.currentUtterance.rate = rate;
						this.currentUtterance.pitch = pitch;
						this.currentUtterance.volume = volume;
						if (this.currentVoice) {
							this.currentUtterance.voice = this.currentVoice;
						} else {

							const voices = this.synth.getVoices();
							const emmaVoice = voices.find(voice =>
								voice.name.includes('Emma') || voice.name.includes('Microsoft Emma') || voice.name.includes('EmmaMultilingual')
							);
							if (emmaVoice) {
								this.currentUtterance.voice = emmaVoice;
								this.currentVoice = emmaVoice;
							} else if (voices.length > 0) {
								const englishVoice = voices.find(voice => voice.lang.startsWith('en-')) || voices[0];
								this.currentUtterance.voice = englishVoice;
								this.currentVoice = englishVoice;
							}
						}
						this.currentUtterance.onend = () => {
							this.isSpeaking = false;
							resolve();
						};
						this.currentUtterance.onerror = (error) => {
							this.isSpeaking = false;
							reject(error);
						};
						this.isSpeaking = true;
						this.synth.speak(this.currentUtterance);
					} catch (error) {
						reject(error);
					}
				});
			}
			stop() {
				if (this.isSpeaking && this.synth.speaking) {
					this.synth.cancel();
					this.isSpeaking = false;
				}
			}
		}
		class EssayManager {
			constructor() {
				this.panel = document.getElementById('essayPanel');
				this.title = document.getElementById('essayTitle');
				this.content = document.getElementById('essayContent');
				this.closeBtn = document.getElementById('essayClose');
				this.expandBtn = document.getElementById('essayExpandBtn');
				this.audioControls = document.getElementById('essayAudioControls');
				this.audioPlayBtn = document.getElementById('essayAudioPlay');
				this.ttsPlayBtn = document.getElementById('essayTTSPlay');
				this.audioProgress = document.getElementById('essayAudioProgress');
				this.audioTime = document.getElementById('essayAudioTime');
				this.currentAudio = null;
				this.isPlaying = false;
				this.isTTSPlaying = false;
				this.currentEssay = null;
				this.isExpanded = false;
				this.initEventListeners();
			}
			initEventListeners() {
				if(this.closeBtn)
				this.closeBtn.addEventListener('click', () => {
					this.hide();
				});
				if(this.expandBtn)
				this.expandBtn.addEventListener('click', () => {
					this.toggleSize();
				});
				this.audioPlayBtn.addEventListener('click', () => {
					this.toggleAudioPlayback();
				});
				this.ttsPlayBtn.addEventListener('click', () => {
					this.toggleTTSPlayback();
				});
				this.audioProgress.addEventListener('input', (e) => {
					this.seekAudio(parseInt(e.target.value));
				});
				this.audioProgress.addEventListener('change', (e) => {
					this.seekAudio(parseInt(e.target.value));
				});
			}
			toggleSize() {
				this.isExpanded = !this.isExpanded;
				if (this.isExpanded) {
					this.panel.classList.add('big');
					document.body.classList.add('big');
					this.expandBtn.title = "Áº©Â∞èÈù¢Êùø";
					this.expandBtn.innerHTML = '‚ñ£';
				} else {
					this.panel.classList.remove('big');
					document.body.classList.remove('big');
					this.expandBtn.title = "Êâ©Â§ßÈù¢Êùø";
					this.expandBtn.innerHTML = '‚õ∂';
				}
				setTimeout(() => {
					this.updateContentScroll();
				}, 300);
			}
			updateContentScroll() {
				const needsScrollbar = this.content.scrollHeight > this.content.clientHeight;
				this.content.style.overflowY = needsScrollbar ? 'auto' : 'hidden';
			}
			toggleAudioPlayback() {
				if (!this.currentAudio || !this.currentEssay) return;
				if (this.isPlaying) {
					this.pauseAudio();
				} else {
					this.playAudio();
				}
			}
			playAudio() {
				if (!this.currentAudio) {
					this.loadAudio();
				}
				if (this.currentAudio) {
					this.currentAudio.play().then(() => {
						this.isPlaying = true;
						this.audioPlayBtn.textContent = '‚ùö‚ùö';
						this.audioPlayBtn.classList.add('playing');
					}).catch(error => {
						console.error('Èü≥È¢ëÊí≠ÊîæÂ§±Ë¥•:', error);
						toastManager.show('Èü≥È¢ëÊí≠ÊîæÂ§±Ë¥•', 'error', 2000);

						this.tryTTSOnAudioError();
					});
				}
			}
			pauseAudio() {
				if (this.currentAudio) {
					this.currentAudio.pause();
					this.isPlaying = false;
					this.audioPlayBtn.textContent = '‚ñ∂';
					this.audioPlayBtn.classList.remove('playing');
				}
			}
			loadAudio() {
				if (isTTSSupported && (!this.currentEssay|| !this.currentEssay.mp3)) {

					this.hideAudioControls();
					this.showTTSControls();
					this.panel.classList.remove('has-audio');
					this.panel.classList.add('has-tts');
					return;
				}
				try {
					this.currentAudio = new Audio(this.currentEssay.mp3+'.mp3');

					this.currentAudio.addEventListener('canplay', () => {
						this.showAudioControls();
						this.updateAudioTimeDisplay();
					});

					this.currentAudio.addEventListener('error', (e) => {
						//console.error('Èü≥È¢ëÂä†ËΩΩÂ§±Ë¥•:', e);

						if(!isTTSSupported)return;
						this.hideAudioControls();
						this.showTTSControls();
						this.panel.classList.remove('has-audio');
						this.panel.classList.add('has-tts');
					});

					this.currentAudio.addEventListener('loadedmetadata', () => {

						if (!this.audioControls.style.display || this.audioControls.style.display === 'none') {
							this.showAudioControls();
							this.updateAudioTimeDisplay();
						}
					});
					this.currentAudio.addEventListener('timeupdate', () => {
						this.updateProgress();
					});
					this.currentAudio.addEventListener('ended', () => {
						this.isPlaying = false;
						this.audioPlayBtn.textContent = '‚ñ∂';
						this.audioPlayBtn.classList.remove('playing');
						this.audioProgress.value = 0;
						this.updateAudioTimeDisplay();
					});
				} catch (error) {
					console.error('ÂàõÂª∫Èü≥È¢ëÂØπË±°Â§±Ë¥•:', error);

					if(!isTTSSupported)return;
					this.hideAudioControls();
					this.showTTSControls();
					this.panel.classList.remove('has-audio');
					this.panel.classList.add('has-tts');
				}
			}
			tryTTSOnAudioError() {

				this.pauseAudio();

				if(!isTTSSupported)return;
				this.hideAudioControls();
				this.showTTSControls();
				this.panel.classList.remove('has-audio');
				this.panel.classList.add('has-tts');
			}
			seekAudio(progress) {
				if (!this.currentAudio) return;
				const duration = this.currentAudio.duration;
				if (duration && isFinite(duration)) {
					this.currentAudio.currentTime = (progress / 100) * duration;
				}
			}
			updateProgress() {
				if (!this.currentAudio) return;
				const duration = this.currentAudio.duration;
				const currentTime = this.currentAudio.currentTime;
				if (duration && isFinite(duration)) {
					const progress = (currentTime / duration) * 100;
					this.audioProgress.value = progress;
					this.updateAudioTimeDisplay();
				}
			}
			updateAudioTimeDisplay() {
				if (!this.currentAudio) return;
				const duration = this.currentAudio.duration;
				const currentTime = this.currentAudio.currentTime;
				if (duration && isFinite(duration)) {
					const formatTime = (time) => {
						const minutes = Math.floor(time / 60);
						const seconds = Math.floor(time % 60);
						return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
					};
					this.audioTime.textContent = `${formatTime(currentTime)} / ${formatTime(duration)}`;
				}
			}
			showAudioControls() {
				//
				this.audioControls.style.display = 'block';
				this.audioPlayBtn.style.display = 'flex';
				this.ttsPlayBtn.style.display = 'none';
			}
			hideAudioControls() {
				this.audioControls.style.display = 'none';
			}
			showTTSControls() {
				if(!isTTSSupported)return;
				this.audioControls.style.display = 'block';
				this.audioPlayBtn.style.display = 'none';
				this.ttsPlayBtn.style.display = 'flex';
				this.audioTime.textContent="üëà‰∏çËÉΩÊãñÂä®(Âú®Á∫øÁîüÊàêÁöÑËØ≠Èü≥)ÔºåÂèØËÉΩ‰ºöÂç°È°ø„ÄÅÁîöËá≥Êí≠Êîæ‰∏ç‰∫Ü„ÄÇ";
			}
			resetAudio() {
				if (this.currentAudio) {
					this.currentAudio.pause();
					this.currentAudio = null;
				}
				this.isPlaying = false;
				this.audioPlayBtn.textContent = '‚ñ∂';
				this.audioPlayBtn.classList.remove('playing');
				this.audioProgress.value = 0;
				this.audioTime.textContent = '00:00 / 00:00';
			}
			resetTTS() {
				speechManager.stop();
				this.isTTSPlaying = false;
				this.ttsPlayBtn.textContent = '‚ñ∂';
				this.ttsPlayBtn.classList.remove('playing');
			}
			resetSize() {
				this.isExpanded = false;
				this.panel.classList.remove('big');
				document.body.classList.remove('big');
				this.expandBtn.title = "Êâ©Â§ßÈù¢Êùø";
				this.expandBtn.innerHTML = '‚õ∂';
			}
			async toggleTTSPlayback() {
				if (!this.currentEssay || !isTTSSupported) return;
				if (this.isTTSPlaying) {
					this.pauseTTS();
				} else {
					await this.playTTS();
				}
			}
			async playTTS() {
				if (!isTTSSupported) {
					toastManager.show('ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅËØ≠Èü≥ÊúóËØªÂäüËÉΩ', 'warning', 2000);
					return;
				}
				this.isTTSPlaying = true;
				this.ttsPlayBtn.textContent = '‚ùö‚ùö';
				this.ttsPlayBtn.classList.add('playing');
				try {
					await speechManager.speak(this.currentEssay.con);
				} catch (e) {
					console.error('TTS ÈîôËØØ:', e);
				} finally {
					this.isTTSPlaying = false;
					this.ttsPlayBtn.textContent = '‚ñ∂';
					this.ttsPlayBtn.classList.remove('playing');
				}
			}
			pauseTTS() {
				speechManager.stop();
				this.isTTSPlaying = false;
				this.ttsPlayBtn.textContent = '‚ñ∂';
				this.ttsPlayBtn.classList.remove('playing');
			}
			show(essay,limit) {
				if(!limit)limit=wordsPerPage;
				if (this.currentEssay && this.currentEssay.p === essay.p)return;
				this.currentEssay = essay;
				this.title.textContent = "„Ää "+essay.tit+" „Äã";
				const startIndex = (currentPage - 1) * limit;
				const endIndex = Math.min(startIndex + limit, currentWordData.length);
				const pageWords = currentWordData.slice(startIndex, endIndex).map(word => word.W.toLowerCase());
				let processedContent = essay.con;
				const sortedWords = [...pageWords].sort((a, b) => b.length - a.length);
				sortedWords.forEach(word => {
					const regex = new RegExp(`(\\s|^)(${word})(\\s|$|[.,;!?])`, 'gi');
					processedContent = processedContent.replace(regex, '$1<span class="highlight">$2</span>$3');
				});
				const paragraphs = processedContent.split('\n').filter(p => p.trim() !== '');
				processedContent = paragraphs.map(paragraph =>`<p>${paragraph}</p>`).join('');
				this.content.innerHTML = processedContent;
				const hasAudio = essay.mp3 && essay.mp3.trim() !== '';
				if (hasAudio) {
					this.resetAudio();
					this.resetTTS();
					this.loadAudio();
					this.panel.classList.add('has-audio');
					this.panel.classList.remove('has-tts');
				} else {
					this.hideAudioControls();
					this.resetAudio();
					this.resetTTS();
					this.showTTSControls();
					this.panel.classList.remove('has-audio');
					this.panel.classList.add('has-tts');
				}
				this.resetSize();
				this.panel.className = 'essay-panel show' + (hasAudio ? ' has-audio' : ' has-tts');
				document.body.classList.add('essay-panel-visible');
				setTimeout(() => {
					this.updateContentScroll();
				}, 100);
			}
			hide() {
				this.pauseAudio();
				this.pauseTTS();
				this.resetAudio();
				this.resetTTS();
				this.resetSize();
				this.currentEssay = null;
				this.panel.className = 'essay-panel';
				this.panel.classList.remove('has-audio', 'has-tts');
				document.body.classList.remove('essay-panel-visible');
			}
			checkAndShowEssay(page) {
				const essay = originalWordData.essay.find(e => e.p === page);
				if (essay && currentFilter === 'all' && !currentSearchQuery) {
					this.show(essay);
				} else {
					this.hide();
				}
			}
		}
		class WordStateManager {
			constructor() {
				this.defaultLearnedWords = originalWordData.yixue;
				this.loadFromStorage();
				this.loadUnitSelectionsFromStorage();
				this.updateLearnedWordsWithUnits();
			}
			loadUnitSelectionsFromStorage() {
				const stored = localStorage.getItem('selectedUnits');
				if (stored) {
					try {
						this.selectedUnits = new Set(JSON.parse(stored));
					} catch (e) {
						console.error("Âä†ËΩΩÂçïÂÖÉÈÄâÊã©Â§±Ë¥•:", e);
						this.selectedUnits = new Set();
					}
				} else {
					this.selectedUnits = new Set();
				}
			}
			saveUnitSelectionsToStorage() {
				localStorage.setItem('selectedUnits', JSON.stringify([...this.selectedUnits]));
			}
			updateLearnedWordsWithUnits() {
				let baseLearnedSet = new Set(this.defaultLearnedWords.split(',').map(w => w.trim().toLowerCase()));
				originalWordData.daixue.forEach(unit => {
					if (this.selectedUnits.has(`${unit.grade}-${unit.unit}`)) {
						unit.W.split(',').forEach(word => {
							const trimmedWord = word.trim().toLowerCase();
							if (trimmedWord) {
								baseLearnedSet.add(trimmedWord);
							}
						});
					}
				});
				const allLearned = new Set([...baseLearnedSet, ...this.newLearnedWords]);
				this.forgottenWords.forEach(word => allLearned.delete(word));
				this.learnedWords = allLearned;
			}
			toggleUnitSelection(grade, unitNum) {
				const key = `${grade}-${unitNum}`;
				if (this.selectedUnits.has(key)) {
					this.selectedUnits.delete(key);
				} else {
					this.selectedUnits.add(key);
				}
				this.saveUnitSelectionsToStorage();
				this.updateLearnedWordsWithUnits();
			}
			isUnitSelected(grade, unitNum) {
				return this.selectedUnits.has(`${grade}-${unitNum}`);
			}
			loadFromStorage() {
				this.forgottenWords = new Set(this.parseStorage(localStorage.getItem('forgotten')));
				this.newLearnedWords = new Set(this.parseStorage(localStorage.getItem('newLearned')));
			}
			parseStorage(data) {
				if (!data) return [];
				return data.split(',').map(word => word.trim().toLowerCase()).filter(word => word);
			}
			getWordState(word) {
				const wordLower = word.toLowerCase();
				const isDefaultLearned = this.defaultLearnedWords.toLowerCase().includes(wordLower);
				const isForgotten = this.forgottenWords.has(wordLower);
				const isLearned = this.learnedWords.has(wordLower);
				return {
					isDefaultLearned,
					isLearned,
					isForgotten,
				};
			}
			getWordClickTitle(word) {
				const state = this.getWordState(word);
				if (state.isForgotten) {
					return "ÂèñÊ∂àÊ†áËÆ∞";
				} else if (state.isLearned) {
					return "ÁÇπÂáªÊ†áËÆ∞‰∏∫ÂøòËÆ∞";
				} else {
					return "ÁÇπÂáªÊ†áËÆ∞‰∏∫Â∑≤Â≠¶";
				}
			}
			getPhoneticClickTitle(word, currentFilter) {
				const state = this.getWordState(word);
				if (state.isForgotten) {
					if(currentFilter === "forgotten") return "ÂèñÊ∂àÊ†áËÆ∞";
					return "ÁÇπÂáªÊ†áËÆ∞‰∏∫Â∑≤Â≠¶‰ºö";
				} else if (state.isLearned) {
					return "ÁÇπÂáªÊ†áËÆ∞‰∏∫ÂøòËÆ∞";
				} else {
					return "ÁÇπÂáªÊ†áËÆ∞‰∏∫Â∑≤Â≠¶";
				}
			}
			handleWordClick(word) {
				const wordLower = word.toLowerCase();
				const state = this.getWordState(word);
				let result;
				if (state.isForgotten) {
					this.newLearnedWords.delete(wordLower);
					this.forgottenWords.delete(wordLower);
					result = { success: true, message: `Â∑≤ÂèñÊ∂à "${word}" ÁöÑÂøòËÆ∞Ê†áËÆ∞`, type: 'success' };
				} else if (state.isLearned) {
					this.newLearnedWords.delete(wordLower);
					this.forgottenWords.add(wordLower);
					result = { success: true, message: `Â∑≤Ê†áËÆ∞ "${word}" ‰∏∫ÂøòËÆ∞`, type: 'info' };
				} else {
					this.newLearnedWords.add(wordLower);
					result = { success: true, message: `Â∑≤Ê†áËÆ∞ "${word}" ‰∏∫Â∑≤Â≠¶`, type: 'success' };
				}
				this.saveToStorage();
				this.updateLearnedWordsWithUnits();
				return result;
			}
			saveToStorage() {
				localStorage.setItem('newLearned', Array.from(this.newLearnedWords).join(','));
				localStorage.setItem('forgotten', Array.from(this.forgottenWords).join(','));
			}
			getFilteredWords(words, filterType) {
				if(filterType !== 'cache' && document.getElementById("cachediv")) {
					document.getElementById("cachediv").style.display = "none";
				}
				this.updateLearnedWordsWithUnits();
				switch(filterType) {
					case 'high':
						return words.filter(word => word.P==1);
					case 'medium':
						return words.filter(word => word.P==2);
					case 'low':
						return words.filter(word => word.P==3);
					case 'learned':
						return words.filter(word => this.learnedWords.has(word.W.toLowerCase()));
					case 'no':
						return words.filter(word => !this.learnedWords.has(word.W.toLowerCase()));
					case 'forgotten':
						return words.filter(word => this.forgottenWords.has(word.W.toLowerCase()));
					case 'random':
						const learnedWords = words.filter(word => this.learnedWords.has(word.W.toLowerCase()));
						return this.getRandomWords(learnedWords, 10);
					case 'cache':
						return [...words];
					default:
						return [...words];
				}
			}
			getRandomWords(words, count) {
				if (words.length <= count) return [...words];
				const shuffled = [...words].sort(() => 0.5 - Math.random());
				return shuffled.slice(0, count);
			}
		}
		class ToastManager {
			constructor() {
				this.container = document.getElementById('toastContainer');
				this.toasts = new Set();
			}
			show(message, type = 'info', duration = 3000) {
				const toast = document.createElement('div');
				toast.className = `toast ${type}`;
				toast.innerHTML = message;
				toast.addEventListener('click', () => this.hide(toast));
				this.container.appendChild(toast);
				setTimeout(() => toast.classList.add('show'), 10);
				if (duration > 0) setTimeout(() => this.hide(toast), duration);
				this.toasts.add(toast);
				return toast;
			}
			hide(toast) {
				toast.classList.remove('show');
				toast.classList.add('hide');
				setTimeout(() => {
					if (toast.parentNode) toast.parentNode.removeChild(toast);
					this.toasts.delete(toast);
				}, 300);
			}
		}
		class VerbDetailManager {
			constructor() {
				this.overlay = document.getElementById('verbModalOverlay');
				this.title = document.getElementById('verbModalTitle');
				this.content = document.getElementById('verbModalContent');
				this.closeBtn = document.getElementById('verbModalClose');
				this.initEventListeners();
			}
			initEventListeners() {
				this.closeBtn.addEventListener('click', () => {
					this.hide();
				});
				this.overlay.addEventListener('click', (e) => {
					if (e.target === this.overlay) {
						this.hide();
					}
				});
				document.addEventListener('keydown', (e) => {
					if (e.key === 'Escape' && this.overlay.classList.contains('active')) {
						this.hide();
					}
				});
			}
			show(word) {
				const verbData = this.findVerbData(word);
				if (!verbData) {
					toastManager.show(`Êú™ÊâæÂà∞"${word}"ÁöÑÂä®ËØçÂèòÂåñÊï∞ÊçÆ`, 'warning', 2000);
					return;
				}
				this.title.textContent = word;
				this.renderContent(verbData);
				this.overlay.classList.add('active');
			}
			hide() {
				this.overlay.classList.remove('active');
			}
			findVerbData(word) {
				return originalWordData.dongci.find(verb =>
					verb.W.toLowerCase() === word.toLowerCase()
				);
			}
			renderContent(verbData) {
				let html = `
					<div class="verb-forms">
						<div class="verb-form-grid">
							<div class="verb-form-item ${verbData.F.A?"play":""}">
								<div class="verb-form-label">ÂéüÂΩ¢</div>
								<div class="verb-form-value" data-verb="${verbData.F.A?verbData.F.A:""}">${verbData.F.A?verbData.F.A:"--"}</div>
							</div>
							<div class="verb-form-item ${verbData.F.B?"play":""}">
								<div class="verb-form-label">ËøáÂéªÂºè</div>
								<div class="verb-form-value" data-verb="${verbData.F.B?verbData.F.B:""}">${verbData.F.B?verbData.F.B:"--"}</div>
							</div>
							<div class="verb-form-item ${verbData.F.C?"play":""}">
								<div class="verb-form-label">ËøáÂéªÂàÜËØç</div>
								<div class="verb-form-value" data-verb="${verbData.F.C?verbData.F.C:""}">${verbData.F.C?verbData.F.C:"--"}</div>
							</div>
							<div class="verb-form-item ${verbData.F.D?"play":""}">
								<div class="verb-form-label">Áé∞Âú®ÂàÜËØç</div>
								<div class="verb-form-value" data-verb="${verbData.F.D?verbData.F.D:""}">${verbData.F.D?verbData.F.D:"--"}</div>
							</div>
						</div>
					</div>
					<div class="verb-examples">
				`;
				if (verbData.exp.A && verbData.exp.A.length > 0) {
					html += this.renderExampleType('ÂéüÂΩ¢', verbData.exp.A, verbData.F.A);
				}
				if (verbData.exp.B && verbData.exp.B.length > 0) {
					html += this.renderExampleType('ËøáÂéªÂºè', verbData.exp.B, verbData.F.B);
				}
				if (verbData.exp.C && verbData.exp.C.length > 0) {
					html += this.renderExampleType('ËøáÂéªÂàÜËØç', verbData.exp.C, verbData.F.C);
				}
				if (verbData.exp.D && verbData.exp.D.length > 0) {
					html += this.renderExampleType('Áé∞Âú®ÂàÜËØç', verbData.exp.D, verbData.F.D);
				}
				html += `</div>`;
				this.content.innerHTML = html;

				//Êí≠ÊîæÊúâÈÅìÂçïËØçËØªÈü≥
				const formValues = this.content.querySelectorAll('.verb-form-value');
				formValues.forEach(valueElement => {
					const word = valueElement.getAttribute('data-verb');
					if (word) {
						valueElement.style.cursor = 'pointer';
						valueElement.addEventListener('click', (e) => {
							e.stopPropagation();
							const mp3 = "http://dict.youdao.com/dictvoice?type=0&audio=" + word;
							playAudio(mp3, null);
						});
					}
				});



				this.addExampleClickListeners();
			}
			renderExampleType(type, examples, form) {
				let html = `
					<div class="verb-example-type">
						<div class="verb-example-type-title">${type} (<span class="verb-form-value">${form}</span>)</div>
						<ul class="verb-example-list">
				`;
				examples.forEach(example => {
					const [english, chinese] = example.split(' | ');
					html += `
						<li class="verb-example-item" data-english="${english}">
							<span class="example-english">${english}</span>
							<span class="example-chinese">${chinese}</span>
						</li>
					`;
				});
				html += `
						</ul>
					</div>
				`;
				return html;
			}
			addExampleClickListeners() {
				if(!isTTSSupported)return;
				const exampleItems = this.content.querySelectorAll('.verb-example-item');
				exampleItems.forEach(item => {
					item.style.cursor = 'pointer';
					item.title = 'ÁÇπÂáªÊúóËØªËã±Êñá‰æãÂè•';
					item.addEventListener('click', (e) => {
						const englishText = item.getAttribute('data-english');
						if (englishText) {
							speakEnglishExample(englishText);
							if (englishText)speakEnglishExample(englishText, item);
						}
					});
				});
			}
		}

		class ReadAloudManager {
			constructor() {
				this.panel = document.getElementById('readPanel');
				this.input = document.getElementById('readInput');
				this.output = document.getElementById('sentenceOutput');
				this.voiceSelect = document.getElementById('voiceSelect');
				this.rateSlider = document.getElementById('rateSlider');
				this.pitchSlider = document.getElementById('pitchSlider');
				this.rateValue = document.getElementById('rateValue');
				this.pitchValue = document.getElementById('pitchValue');
				this.readAllBtn = document.getElementById('readAllBtn');
				this.pauseBtn = document.getElementById('pauseBtn');
				this.sentences = [];
				this.currentUtterance = null;
				this.isSpeaking = false;
				this.currentVoiceName = '';
				this.init();
			}
			init() {
				this.loadVoices();
				this.bindEvents();
			}
			loadVoices() {
				const synth = window.speechSynthesis;
				let voices = synth.getVoices();

				if (voices.length === 0) {
					synth.addEventListener('voiceschanged', () => {
						voices = synth.getVoices();
						this.populateVoiceList(voices);
						this.initializeSpeechManagerVoice();
					});
				} else {
					this.populateVoiceList(voices);
					this.initializeSpeechManagerVoice();
				}
			}
			initializeSpeechManagerVoice() {
				const selectedVoiceName = this.voiceSelect.value;
				speechManager.setVoice(selectedVoiceName);
				this.currentVoiceName = selectedVoiceName;
			}
			populateVoiceList(voices) {
				this.voiceSelect.innerHTML = '';
				const filteredVoices = voices.filter(v =>
					v.lang.startsWith('en-US') || v.lang.startsWith('zh-CN')
				);

				const emmaVoice = filteredVoices.find(v => v.name.includes('Emma'));
				if (emmaVoice) {
					const option = document.createElement('option');
					option.value = emmaVoice.name;
					option.textContent = `${emmaVoice.name.replace(/Microsoft|Online|\([\w\s\,]+\)/gi, '')}`; //(${emmaVoice.lang})
					option.selected = true;
					this.voiceSelect.appendChild(option);
					this.currentVoiceName = emmaVoice.name;
				}
				filteredVoices.forEach(voice => {
					if (emmaVoice && voice.name === emmaVoice.name) return;
					const option = document.createElement('option');
					option.value = voice.name;
					option.textContent = `${voice.name.replace(/Microsoft|Online|\([\w\s\,]+\)/gi, '')}`;// (${voice.lang})
					this.voiceSelect.appendChild(option);
				});
				this.initializeSpeechManagerVoice();
			}
			bindEvents() {
				this.input.addEventListener('input', () => this.formatText());
				this.rateSlider.addEventListener('input', (e) => {
					this.rateValue.textContent = e.target.value;
				});
				this.pitchSlider.addEventListener('input', (e) => {
					this.pitchValue.textContent = e.target.value;
				});

				this.voiceSelect.addEventListener('change', () => {
					const selectedVoiceName = this.voiceSelect.value;
					speechManager.setVoice(selectedVoiceName);
					this.currentVoiceName = selectedVoiceName;
				});
				this.readAllBtn.addEventListener('click', () => this.readAll());
				this.pauseBtn.addEventListener('click', () => this.pause());

				this.output.addEventListener('click', (e) => {
					const sentenceEl = e.target.closest('.read-sentence');
					if (sentenceEl) {
						const text = sentenceEl.dataset.text;
						this.speakText(text, sentenceEl);
					}
				});
			}
			formatText() {
				const text = this.input.value.trim();
				if (!text) {
					this.output.innerHTML = '';
					this.sentences = [];
					return;
				}

				const paragraphs = text.split(/\n+/).filter(p => p.trim());
				let allSentences = [];
				let html = '';
				paragraphs.forEach((para, pIndex) => {

					//const sentences = para.split(/(?<=[.!?„ÄÇÔºÅÔºü])\s*/).filter(s => s.trim());
					//para=para.replace(/\:/g," : ");
					const sentences = para.split(/(?<!\d\.)(?<!\.[A-Za-z])(?<=[.!?„ÄÇÔºÅÔºü]|:)\s*/).filter(s => s.trim());
					html += `<p style="margin:0 0 3px 0; padding:0;">`;
					sentences.forEach((s, sIndex) => {
						const clean = s.trim();
						if (!clean) return;
						allSentences.push(clean);
						html += `<span class="read-sentence" data-text="${this.escapeHtml(clean)}">
							${this.escapeHtml(clean)}
						</span>`;
					});
					html += `</p>`;
				});
				this.output.style.display="block";
				this.output.innerHTML = html;
				this.sentences = allSentences;
			}
			escapeHtml(text) {
				return text.replace(/[&<>"']/g, m => ({
					'&': '&amp;',
					'<': '<',
					'>': '>',
					'"': '&quot;',
					"'": '&#039;'
				}[m]));
			}
			getSelectedVoice() {
				const selectedName = this.voiceSelect.value;
				const voices = window.speechSynthesis.getVoices();
				return voices.find(v => v.name === selectedName) || voices[0];
			}
			speakText(text, element = null) {
				if (!isTTSSupported) {
					toastManager.show('ÊµèËßàÂô®‰∏çÊîØÊåÅËØ≠Èü≥ÊúóËØª', 'warning', 2000);
					return;
				}
				if (element)element.classList.add('reading-ing');
				const rate = parseFloat(this.rateSlider.value);
				const pitch = parseFloat(this.pitchSlider.value);
				const voice = this.getSelectedVoice();
				speechManager.speak(text, rate, pitch, 1.0)
				.finally(() => {
					if (element)element.classList.remove('reading-ing');
				});
			}
			async readAll() {
				if (!this.sentences.length) return;
				if (!isTTSSupported) {
					toastManager.show('ÊµèËßàÂô®‰∏çÊîØÊåÅËØ≠Èü≥ÊúóËØª', 'warning', 2000);
					return;
				}
				speechManager.stop();
				const fullText = this.sentences.join(' ');
				const rate = parseFloat(this.rateSlider.value);
				const pitch = parseFloat(this.pitchSlider.value);
				const voice = this.getSelectedVoice();
				try {
					await speechManager.speak(fullText, rate, pitch, 1.0);
				} catch (e) {
					console.error('ÊúóËØªÂ§±Ë¥•:', e);
					toastManager.show('ÊúóËØªÂ§±Ë¥•ÔºåËØ∑ÈáçËØï', 'error', 2000);
				}
			}
			pause() {
				speechManager.stop();
			}
		}
		const speechManager = new SpeechManager();
		const wordManager = new WordStateManager();
		const toastManager = new ToastManager();
		const verbManager = new VerbDetailManager();
		const essayManager = new EssayManager();
		let currentWordData = [...originalWordData.data];
		let isSorted = false;
		const isTTSSupported = 'speechSynthesis' in window;
		if(!isTTSSupported)document.body.classList.add('no-tts');
        const isMobile = (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent));
        const isEdge = /Edg\//i.test(navigator.userAgent) || /Edge\//i.test(navigator.userAgent);
		const wordsPerPage = isMobile ? 5 : 20;
		let totalPages = Math.ceil(currentWordData.length / wordsPerPage);
		let currentPage = 1;
		let currentAudio = null;
		let currentSearchQuery = '';
		let currentFilter = 'all';
		let defaultFilteredData = [...currentWordData];
		let unitSelectorContainer = document.getElementById('unitSelectorContainer');
		const wordContainer = document.getElementById('wordContainer');
		const pagination = document.getElementById('pagination');
		const searchInput = document.getElementById('searchInput');
		const sortBtn = document.getElementById('sortBtn');
		const filterLinks = document.querySelectorAll('h1 a');
		const fuzzySearchCheckbox = document.getElementById('fuzzySearch');
		const printFooter = document.getElementById('printFooter');
		async function speakEnglishExample(text, element = null) {
			try {
				if (!isTTSSupported) {
					toastManager.show('ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅËØ≠Èü≥ÂêàÊàêÂäüËÉΩ', 'warning', 2000);
					return;
				}
				if (element)element.classList.add('reading-ing');
				text=text.trim().replace(/[.,;:!?]+$/, '').split(/\s+/).filter(w => w).join(' , ');

				const rate = parseFloat(document.getElementById('rateSlider')?.value || 0.9);
				const pitch = parseFloat(document.getElementById('pitchSlider')?.value || 1.0);
				await speechManager.speak(text, rate, pitch, 1.0);
			} catch (error) {
				console.error('ËØ≠Èü≥ÂêàÊàêÈîôËØØ:', error);
			} finally {
				if (element)element.classList.remove('reading-ing');
			}
		}


		function applyFilter(filterType) {
			currentFilter = filterType;
			if (filterType === 'group') {
				document.getElementById('readPanel').style.display = 'none';
				document.querySelector('.controls').style.display = 'none';
				document.getElementById('pagination').classList.add("hide");
				if(document.getElementById("cachediv")){
					document.getElementById("cachediv").style.display = "none";
					document.getElementById("unitSelectorContainer").style.display = "none";
				}
				document.getElementById('wordContainer').style.display = 'block';
				renderGroupSelector();
				updateActiveFilterLink();
				updateUrlParams();
				essayManager.hide();
				return;
			}
			if (filterType === 'read') {
				document.getElementById('readPanel').style.display = 'block';
				document.getElementById('wordContainer').style.display = 'none';
				document.getElementById('pagination').classList.add("hide");
				document.querySelector('.controls').style.display = 'none';
				if (!readAloudManager) {
					readAloudManager = new ReadAloudManager();
				}
			}else if (filterType === 'cache') {
				document.getElementById('readPanel').style.display = 'none';
				document.querySelector('.controls').style.display = 'none';
				document.getElementById('wordContainer').style.display = 'none';
				document.getElementById('pagination').classList.add("hide");
				if(document.getElementById("cachediv")) document.getElementById("cachediv").style.display = "block";
			}else {
				document.querySelector('.controls').style.display = 'block';
				document.getElementById('wordContainer').style.display = 'block';
				document.getElementById('pagination').classList.remove("hide");
				document.getElementById('readPanel').style.display = 'none';
				if(document.getElementById("cachediv")) document.getElementById("cachediv").style.display = "none";
			}
			defaultFilteredData = wordManager.getFilteredWords(originalWordData.data, filterType);
			currentWordData = [...defaultFilteredData];
			originalSearchResult = [];
			isSorted = false;
			sortBtn.textContent = 'ÊåâÂ≠óÊØçÊéíÂ∫è';
			totalPages = Math.ceil(currentWordData.length / wordsPerPage);
			if (currentPage > totalPages) currentPage = 1;
			searchWords();
			updateActiveFilterLink();
			renderUnitSelector();
			essayManager.checkAndShowEssay(currentPage);
		}
		function renderGroupSelector() {
			const container = document.getElementById('wordContainer');
			const pagination = document.getElementById('pagination');
			container.innerHTML = '';
			pagination.innerHTML = '';
			const groupedData = originalWordData.group;
			if (!groupedData || Object.keys(groupedData).length === 0) {
				container.innerHTML = '<div class="no-results">Ê≤°ÊúâÂàÜÁ±ªÂèØÁî®</div>';
				return;
			}

			const groupContainer = document.createElement('div');
			groupContainer.id = 'groupSelectorContainer';
			groupContainer.style.cssText = 'margin-bottom: 20px;border: 3px solid #eee; border-radius: 8px;';
			for (const [topCategoryName, subCategories] of Object.entries(groupedData)) {

				const categoryHeader = document.createElement('div');
				categoryHeader.className = 'group-category-header';
				categoryHeader.textContent = topCategoryName;
				groupContainer.appendChild(categoryHeader);

				const subCategoryButtonsDiv = document.createElement('div');
				subCategoryButtonsDiv.className = 'group-selector';
				subCategoryButtonsDiv.style.cssText = 'padding-left:2rem;display: flex; flex-wrap: wrap; gap: 10px;';

				for (const [subCategoryName, wordListString] of Object.entries(subCategories)) {
					const label = document.createElement('label');
					const button = document.createElement('span');
					button.innerHTML = subCategoryName;
					button.onclick = () => {
						const wordList = wordListString.trim().replace(/,$/g, '');
						if (wordList) {
							const queryString = wordList;
							let title = encodeURIComponent('„Äê' + subCategoryName + "„ÄëÁ±ª");
							const newUrl = `?q=${encodeURIComponent(queryString)}&fuzzy=false&title=${title}`;
							window.location.href = newUrl;
						} else {
							console.warn(`ÂàÜÁ±ª "${subCategoryName}" ÁöÑÂçïËØçÂàóË°®‰∏∫Á©∫ÊàñÊ†ºÂºè‰∏çÊ≠£Á°Æ: ${wordListString}`);
						}
					};
					label.appendChild(button);
					subCategoryButtonsDiv.appendChild(label);
				}
				groupContainer.appendChild(subCategoryButtonsDiv);
			}

			//ÊåâÁÖßÂπ¥Á∫ßÊòæÁ§∫ÂàÜÁ±ª
			const daixueData = originalWordData.daixue;
			if (daixueData && daixueData.length > 0) {
				const groupedDaixue = {};
				daixueData.forEach(unit => {
					if (!groupedDaixue[unit.grade]) {
						groupedDaixue[unit.grade] = [];
					}
					groupedDaixue[unit.grade].push(unit);
				});

				const daixueHeader = document.createElement('div');
				daixueHeader.className = 'group-category-h2';
				groupContainer.appendChild(daixueHeader);

				for (const [grade, units] of Object.entries(groupedDaixue)) {
					const gradeHeader = document.createElement('div');
					gradeHeader.className = 'group-category-header';
					gradeHeader.textContent = `${grade}:`;
					groupContainer.appendChild(gradeHeader);

					const unitButtonsDiv = document.createElement('div');
					unitButtonsDiv.className = 'group-selector';
					unitButtonsDiv.style.cssText = 'padding-left:2rem;display: flex; flex-wrap: wrap; gap: 10px;';

					units.forEach(unit => {
						const label = document.createElement('label');
						const button = document.createElement('span');
						button.innerHTML = unit.unit;
						button.onclick = () => {
							const wordListString = unit.W;
							if (wordListString) {
								const queryString = wordListString.trim().replace(/,$/g, '');
								let title = encodeURIComponent(`„Äê${grade} - ${unit.unit}„Äë`);
								const newUrl = `?q=${encodeURIComponent(queryString)}&fuzzy=false&title=${title}`;
								window.location.href = newUrl;
							} else {
								console.warn(`ÂçïÂÖÉ "${unit.unit}" ÁöÑÂçïËØçÂàóË°®‰∏∫Á©∫: ${unit.W}`);
							}
						};
						label.appendChild(button);
						unitButtonsDiv.appendChild(label);
					});
					groupContainer.appendChild(unitButtonsDiv);
				}
			}


			container.appendChild(groupContainer);
		}
		function exportCache() {
			const cacheData = {
				newLearned: localStorage.getItem('newLearned') || '',
				forgotten: localStorage.getItem('forgotten') || '',
				selectedUnits: localStorage.getItem('selectedUnits') || '[]',
				timestamp: new Date().toISOString()
			};
			const dataStr = JSON.stringify(cacheData);
			const blob = new Blob([dataStr], { type: 'application/json' });
			const url = URL.createObjectURL(blob);
			const a = document.createElement('a');
			a.href = url;
			a.download = `‰∏≠ËÄÉÂçïËØç_cache_${new Date().toISOString().split('T')[0]}.txt`;
			document.body.appendChild(a);
			a.click();
			document.body.removeChild(a);
			URL.revokeObjectURL(url);
			toastManager.show('ÁºìÂ≠òÂØºÂá∫ÊàêÂäü', 'success', 2000);
		}
		function importCache(file) {
			if (!file) {
				const importFile = document.getElementById('importFile');
				if (importFile && importFile.files.length > 0) {
					file = importFile.files[0];
				} else {
					toastManager.show('ËØ∑ÈÄâÊã©Ë¶ÅÂØºÂÖ•ÁöÑÊñá‰ª∂', 'warning', 2000);
					return;
				}
			}
			const reader = new FileReader();
			reader.onload = (e) => {
				try {
					const cacheData = JSON.parse(e.target.result);
					if (cacheData.newLearned) localStorage.setItem('newLearned', cacheData.newLearned);
					if (cacheData.forgotten) localStorage.setItem('forgotten', cacheData.forgotten);
					if (cacheData.selectedUnits) localStorage.setItem('selectedUnits', cacheData.selectedUnits);
					wordManager.loadFromStorage();
					wordManager.loadUnitSelectionsFromStorage();
					wordManager.updateLearnedWordsWithUnits();
					toastManager.show('ÁºìÂ≠òÂØºÂÖ•ÊàêÂäü', 'success', 2000);
					applyFilter(currentFilter);
				} catch (error) {
					toastManager.show('Êñá‰ª∂Ê†ºÂºèÈîôËØØ', 'error', 2000);
				}
			};
			reader.onerror = () => toastManager.show('Êñá‰ª∂ËØªÂèñÂ§±Ë¥•', 'error', 2000);
			reader.readAsText(file);
		}
		function addCacheButtons() {
			const cacheDiv = document.createElement('div');
			cacheDiv.style.cssText = 'margin: 5px 0; display: flex; gap: 10px;';
			cacheDiv.innerHTML = `<div id="cachediv">
				<button class="sort-btn" onclick="
					if(confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÈô§ÊâÄÊúâÁºìÂ≠òÊï∞ÊçÆÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ')) {
						localStorage.clear();
						wordManager.loadFromStorage();
						wordManager.loadUnitSelectionsFromStorage();
						wordManager.updateLearnedWordsWithUnits();
						applyFilter(currentFilter);
						toastManager.show('ÁºìÂ≠òÂ∑≤Ê∏ÖÈô§', 'info', 2000);
					}
				">Ê∏ÖÈô§ÁºìÂ≠ò</button>
				<button class="sort-btn" onclick="exportCache()">ÂØºÂá∫Êï∞ÊçÆ</button>
				<label class="sort-btn" style="cursor: pointer;">
					ÂØºÂÖ•Êï∞ÊçÆ
					<input type="file" id="importFile" accept=".txt"
						   onchange="importCache(this.files[0])"
						   style="display: none;">
				</label></div>
			`;
			const controls = document.querySelector('h1');
			controls.parentNode.insertBefore(cacheDiv, controls.nextSibling);
		}
		function renderUnitSelector() {
			unitSelectorContainer.innerHTML = '';
			if (currentFilter !== 'cache') {
				unitSelectorContainer.style.display = 'none';
				return;
			}
			unitSelectorContainer.style.display = 'block';
			document.getElementById("cachediv").style.display="block";
			const groupedUnits = {};
			originalWordData.daixue.forEach(unit => {
				if (!groupedUnits[unit.grade]) {
					groupedUnits[unit.grade] = [];
				}
				groupedUnits[unit.grade].push(unit);
			});
			for (const [grade, units] of Object.entries(groupedUnits)) {
				const gradeDiv = document.createElement('div');
				gradeDiv.style.cssText = 'margin-bottom: 8px;';
				const gradeLabel = document.createElement('div');
				gradeLabel.textContent = `${grade}:`;
				gradeLabel.style.cssText = 'margin-bottom: 4px;padding-left:10px;';
				gradeDiv.appendChild(gradeLabel);
				const selectorDiv = document.createElement('div');
				selectorDiv.className = 'unit-selector';
				selectorDiv.style.cssText = 'display: flex; flex-wrap: wrap; gap: 10px;';
				units.forEach(unit => {
					const checkbox = document.createElement('input');
					checkbox.type = 'checkbox';
					checkbox.checked = wordManager.isUnitSelected(unit.grade, unit.unit);
					checkbox.dataset.grade = unit.grade;
					checkbox.dataset.unit = unit.unit;
					checkbox.addEventListener('change', (e) => {
						const grade = e.target.dataset.grade;
						const unitNum = e.target.dataset.unit;
						wordManager.toggleUnitSelection(grade, unitNum);
						applyFilter(currentFilter);
					});
					const label = document.createElement('label');
					label.className=checkbox.checked?"on":"";
					label.appendChild(checkbox);
					label.appendChild(document.createTextNode(`${unit.unit}`));
					selectorDiv.appendChild(label);
				});
				gradeDiv.appendChild(selectorDiv);
				unitSelectorContainer.appendChild(gradeDiv);
			}
		}
		function initKeyboardNavigation() {
			document.addEventListener('keydown', (e) => {
				if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
				switch(e.key) {
					case 'ArrowLeft':
						e.preventDefault();
						goToPreviousPage();
						break;
					case 'ArrowRight':
						e.preventDefault();
						goToNextPage();
						break;
				}
			});
		}

		function getParamsFromUrl() {
			const params = new URLSearchParams(window.location.search);
			return {
				query: params.get('q') || '',
				page: parseInt(params.get('page')) || 1,
				fuzzy: params.get('fuzzy') !== 'false',
				filter: params.get('filter') || 'all',
				cache: params.get('cache') || '',

				title: params.get('title') || ''
			};
		}


		function updateUrlParams() {
			const params = new URLSearchParams();
			const urlParams = getParamsFromUrl();


			if (!urlParams.title) {
				if (currentSearchQuery) params.set('q', currentSearchQuery);
				if (!fuzzySearchCheckbox.checked) params.set('fuzzy', 'false');
			} else {



				params.set('title', urlParams.title);

				if (urlParams.query) params.set('q', urlParams.query);
				if (window.location.search.includes('fuzzy=false')) params.set('fuzzy', 'false');
			}

			if (currentPage > 1) params.set('page', currentPage);
			if (currentFilter !== 'all') params.set('filter', currentFilter);
			const newUrl = `${window.location.pathname}?${params.toString()}`;
			window.history.replaceState(null, '', newUrl);
		}


		function initUrlParams() {
			const urlParams = getParamsFromUrl();
			currentSearchQuery = urlParams.query;
			currentPage = urlParams.page;
			currentFilter = urlParams.filter;
			searchInput.value = currentSearchQuery;
			fuzzySearchCheckbox.checked = urlParams.fuzzy;

			window.isInitializing = true;
			if (urlParams.cache) {
				try {
					const cacheData = JSON.parse(atob(urlParams.cache));
					if (cacheData.newLearned) localStorage.setItem('newLearned', cacheData.newLearned);
					if (cacheData.forgotten) localStorage.setItem('forgotten', cacheData.forgotten);
					if (cacheData.selectedUnits) localStorage.setItem('selectedUnits', cacheData.selectedUnits);
					wordManager.loadFromStorage();
					wordManager.loadUnitSelectionsFromStorage();
					wordManager.updateLearnedWordsWithUnits();
				} catch (e) {
					console.error('URLÁºìÂ≠òËß£ÊûêÂ§±Ë¥•:', e);
				}
			}
			window.isInitializing = false;
			updateActiveFilterLink();

			if (urlParams.title) {
				searchInput.value = urlParams.title;
				searchInput.readOnly = true;
				searchInput.style.backgroundColor = '#e3f2fd';
				searchInput.style.border = '1px solid #2196F3';
				//searchInput.style.borderRadius = '4px';
				//searchInput.style.padding = '7px 12px';

				document.querySelector('.search-box .checkbox').style.display = 'none';
			} else {

				searchInput.readOnly = false;
				searchInput.style.backgroundColor = '';
				searchInput.style.border = '';
				searchInput.style.borderRadius = '';
				searchInput.style.padding = '';
				document.querySelector('.search-box .checkbox').style.display = '';
			}
		}



		function updateActiveFilterLink() {
			filterLinks.forEach(link => {
				const href = link.getAttribute('href');
				const filter = href.includes('filter=') ? href.split('filter=')[1] : 'all';
				link.classList.toggle('active', filter === currentFilter);
			});
		}
		var originalSearchResult = [];
		function searchWords() {
			if (window.isInitializing) {
				return;
			}
			let limit=wordsPerPage;

			const urlParams = getParamsFromUrl();
			// Ê£ÄÊü•ÊòØÂê¶ÂêåÊó∂ÂåÖÂê´ title Âíå q ÂèÇÊï∞
			const groupSearch = !!urlParams.title && !!urlParams.query;
			const query = groupSearch ? urlParams.query : searchInput.value.trim(); // Â¶ÇÊûúÊòØÁâπÊÆäÊ®°ÂºèÔºå‰ΩøÁî® q ÂèÇÊï∞
			currentSearchQuery = query; // Ëøô‰∏™ÂèòÈáè‰ºöË¢´ highlightSearchTerms ‰ΩøÁî®

			if (!query) {
				currentWordData = [...defaultFilteredData];
				originalSearchResult = [];

				if (isSorted) {
					currentWordData.sort((a, b) => a.W.localeCompare(b.W));
				}
			} else {
				if(groupSearch){
					var searchTerms = query.replace(/„ÄÄ|Ôºå|„ÄÇ|„ÄÅ/g,',').split(',').map(term => term.trim()).filter(term => term);
					//limit=90;
					//if(searchTerms.length>10)limit=90;//Â§ö‰∏™ËØçÂêåÊó∂ÊêúÁ¥¢Ôºå1È°µÊòæÁ§∫90‰∏™
				}else{
					var searchTerms = query.replace(/ |„ÄÄ|Ôºå|„ÄÇ|„ÄÅ/g,',').split(',').map(term => term.trim()).filter(term => term);
				}

				// --- ‰øÆÊîπÂºÄÂßãÔºöË∞ÉÊï¥Ê®°Á≥äÊêúÁ¥¢ÈÄªËæë ---
				// Â¶ÇÊûúÊòØÁâπÊÆäÊ®°Âºè (groupSearch)ÔºåÂàôÂøΩÁï• fuzzy ÂèÇÊï∞ÔºåÂº∫Âà∂‰ΩøÁî®ÁâπÊÆäÈÄªËæë
				// Âê¶ÂàôÔºå‰ΩøÁî®ÂéüÊúâÁöÑÈÄªËæë
				const isFuzzy = groupSearch ? false : (urlParams.title ? urlParams.fuzzy : fuzzySearchCheckbox.checked);
				// --- ‰øÆÊîπÁªìÊùü ---

				const termIndexMap = new Map();
				searchTerms.forEach((term, index) => {
					termIndexMap.set(term.toLowerCase(), index);
				});

				const scoredWords = defaultFilteredData.map(word => {
					let score = 0;
					let matchedTermIndex = -1;

					// --- ‰øÆÊîπÂºÄÂßãÔºöÊ†πÊçÆÊ®°ÂºèÂ∫îÁî®‰∏çÂêåÁöÑÊêúÁ¥¢ÈÄªËæë ---
					if (groupSearch) {
						// ÁâπÊÆäÊ®°ÂºèÔºöURL Âê´ title ‰∏îÂê´ q
						searchTerms.forEach(term => {
							// 1. word.W ÂÆåÊï¥ÂåπÈÖç‰∏îÂå∫ÂàÜÂ§ßÂ∞èÂÜô
							if (word.W === term) { // ÂÆåÂÖ®ÂåπÈÖçÔºåÂå∫ÂàÜÂ§ßÂ∞èÂÜô
								score += 100; // È´òÂàÜ
								matchedTermIndex = termIndexMap.get(term.toLowerCase());
							}

							// 2. word.I + word.K Ê®°Á≥äÊêúÁ¥¢ (ÂêàÂπ∂ÂêéÊêúÁ¥¢)Ôºå‰ΩÜ‰∏çÊêúÁ¥¢ÂçïËØçÔºåÈÅøÂÖçÊ®°Á≥äÊêúÁ¥¢ÂàóÂá∫ÈîôËØØÈ°πÁõÆ
							let  combinedSearchText = ((word.I || '') + ' ' + (word.K || '')).replace(/[a-z]/ig,"");
							if (combinedSearchText.toLowerCase().includes(term.toLowerCase())) {
								score += 10; // ËæÉ‰ΩéÂàÜ
								if (matchedTermIndex === -1) {
									matchedTermIndex = termIndexMap.get(term.toLowerCase());
								}
							}/*
							// 3. word.C (Èáä‰πâ) ‰πüËøõË°åÊ®°Á≥äÊêúÁ¥¢Ôºå‰Ωú‰∏∫Ë°•ÂÖÖ
							if (word.C.toLowerCase().includes(term.toLowerCase())) {
								score += 5; // Êõ¥‰ΩéÂàÜ
								if (matchedTermIndex === -1) {
									matchedTermIndex = termIndexMap.get(term.toLowerCase());
								}
							}*/
						});
					} else {
						// ÂéüÊúâÊ®°ÂºèÔºöÊôÆÈÄöÊêúÁ¥¢
						searchTerms.forEach(term => {
							const wordText = word.W.toLowerCase();
							const searchTerm = term.toLowerCase();
							const explanation = word.C.toLowerCase()+" "+((word.I || '') + ' ' + (word.K || ''));
							const example = word.E.toLowerCase();
							const exampleChinese = word.F.toLowerCase();
							if (isFuzzy) {
								if (wordText === searchTerm) {
									score += 100;
									matchedTermIndex = termIndexMap.get(searchTerm);
								}
								else if (wordText.includes(searchTerm)) {
									score += 10;
									if (matchedTermIndex === -1) {
										matchedTermIndex = termIndexMap.get(searchTerm);
									}
								}
								if (explanation.includes(searchTerm) || example.includes(searchTerm)) {
									score += 1;
									if (matchedTermIndex === -1) {
										matchedTermIndex = termIndexMap.get(searchTerm);
									}
								}
								if (exampleChinese.includes(searchTerm)) {
									score += 3;
									if (matchedTermIndex === -1) {
										matchedTermIndex = termIndexMap.get(searchTerm);
									}
								}
							} else {
								if (wordText === searchTerm) {
									score = 100;
									matchedTermIndex = termIndexMap.get(searchTerm);
								}
							}
						});
					}
					// --- ‰øÆÊîπÁªìÊùü ---
					return { word, score, matchedTermIndex };
				});

				let filteredAndScored = scoredWords
					.filter(item => item.score > 0)
					.sort((a, b) => {
						if (a.matchedTermIndex !== b.matchedTermIndex) {
							return a.matchedTermIndex - b.matchedTermIndex;
						}
						return b.score - a.score;
					})
					.map(item => item.word);

				originalSearchResult = [...filteredAndScored];
				currentWordData = [...originalSearchResult];

				if (isSorted) {
					 currentWordData.sort((a, b) => a.W.localeCompare(b.W));
				}
				let l='';
				searchTerms.forEach(term => {
					const searchTerm = term.toLowerCase();
					const foundWord = originalWordData.data.find(word =>
						word.W.toLowerCase() === searchTerm
					);
					const foundInCurrentResults = currentWordData.some(word =>
						word.W.toLowerCase() === searchTerm
					);
					if (foundWord && !foundInCurrentResults) {
						let f_tishi = ""
						if (foundWord.P==1) f_tishi= "È´òÈ¢ë";
						else if (foundWord.P==2) f_tishi= "‰∏≠È¢ë";
						else f_tishi= "‰ΩéÈ¢ë";
						toastManager.show(`"${term}"‰∏çÂú®ÂΩìÂâçÂàÜÁ±ª‰∏≠Ôºå<br>ËØ∑Âú® <b style="color:#ff0">${f_tishi}</b> ÂàÜÁ±ª‰∏ãÊ£ÄÁ¥¢`, 'info', 8000);
					} else if (!foundWord) {
						const foundInDaixue = findWordInDaixue(searchTerm);
						if (foundInDaixue) {
							l+='"'+term+'",';
							toastManager.show(`"${term}"Êú™Êî∂ÂΩïÂçïËØçÂ∫ì<br/>Âú® <b style="color:#ff0">${foundInDaixue.grade} ${foundInDaixue.unit}</b>‰∏≠Â≠¶‰π†`, 'info', 8000);
						}
					}
				});
				if(l)console.log(l);
			}
			totalPages = Math.ceil(currentWordData.length / limit);
			if (currentPage > totalPages) currentPage = 1;
			updateDisplay(limit);
			updateUrlParams();
		}
		function findWordInDaixue(word) {
			const wordLower = word.toLowerCase();
			for (const unit of originalWordData.daixue) {
				const wordsInUnit = unit.W.split(',').map(w => w.trim().toLowerCase());
				if (wordsInUnit.includes(wordLower)) {
					return {
						grade: unit.grade,
						unit: unit.unit,
						word: word
					};
				}
			}
			return null;
		}
		function sortWords(limit) {
			if(!limit)limit=wordsPerPage;
			isSorted = !isSorted;
			if (isSorted) {
				if (originalSearchResult.length > 0) {
					 currentWordData = [...originalSearchResult];
					 currentWordData.sort((a, b) => a.W.localeCompare(b.W));
				} else {
					currentWordData.sort((a, b) => a.W.localeCompare(b.W));
				}
				sortBtn.textContent = 'ÊåâËÄÉÈ¢ëÊéíÂ∫è';
			} else {
				if (originalSearchResult.length > 0) {
					currentWordData = [...originalSearchResult];
				} else {
					currentWordData = [...defaultFilteredData];
				}
				sortBtn.textContent = 'ÊåâÂ≠óÊØçÊéíÂ∫è';
			}
			currentPage = 1;
			totalPages = Math.ceil(currentWordData.length / limit);
			updateDisplay();
		}
		function updateDisplay(limit) {
			if(!limit)limit=wordsPerPage;
			renderWordCards(limit);
			renderPagination(limit);
			updatePrintFooter(limit);
			essayManager.checkAndShowEssay(limit);
		}
		function renderWordCards(limit) {
			if(!limit)limit=wordsPerPage;
			wordContainer.innerHTML = '';
			const startIndex = (currentPage - 1) * limit;
			const endIndex = Math.min(startIndex + limit, currentWordData.length);
			const pageWords = currentWordData.slice(startIndex, endIndex);
			if(!(originalWordData.essay && originalWordData.essay.some(e => e.p === currentPage))){
				let words='Ëøô‰∫õÂçïËØç„Äê'+pageWords.map(w => w.word).join(', ')+'„Äë';
				//Ê≠•È™§1
				console.log('Áî®'+words+'‚ë†ÂÜô‰∏ÄÁØá90~110Â≠óÂ∑¶Âè≥ÁöÑ‰∏≠ËÄÉ‰ΩúÊñáÔºåÊñπ‰æø‰∏≠ËÄÉÂ≠¶ÁîüÂ≠¶‰π†„ÄÇ‚ë°[ÈáçÁÇπ]ÂøÖÈ°ªÂåÖÊã¨‰∏äÈù¢ÁöÑ20‰∏™ÂçïËØç„ÄÇ‚ë¢Ë¶ÅÊ±ÇÁßØÊûÅÂêë‰∏ä„ÄÅËØ≠Âè•ÈÄöÈ°∫„ÄÅËØ≠Ê≥ïÊ≠£Á°Æ„ÄÅÈÄªËæëÊ∏ÖÊô∞„ÄÇ‚ë£Â∞ΩÈáè‰∏çÁî®‰ΩøÁî®Â§ñÂõΩ‰∫∫Âêç„ÄÅÂ§ñÂõΩÂú∞ÂêçÔºåÁ¶ÅÊ≠¢ÂÆóÊïô„ÄÅÁΩëÊ∏∏ÂÜÖÂÆπ„ÄÇ');
				//Ê≠•È™§2
				console.log('ËøôÊòØ‰∏ÄÁØáÂàù‰∏≠Áîü‰ΩúÊñáÔºåËØ∑Ê£ÄÊü•„ÄÇ‚ë†ÂøÖÈ°ªÂåÖÊã¨'+words+'„ÄÇÂ¶ÇÊûúÊ≤°ÊúâÔºåËØ∑Âú®ÈÄÇÂΩì‰ΩçÁΩÆË°•ÂÖÖ„ÄÇ‚ë°‰øÆÊîπËØ≠Ê≥ï„ÄÅÈÄªËæëÈîôËØØ„ÄÇ‚ë¢‰ΩúÊñáÂÜÖÂÆπÁÆÄÊ¥ÅÂèäÁ¨¶ÂêàÂàù‰∏≠ÁîüÊ∞¥Âπ≥ÔºåÂ≠óÊï∞Âú®90~110Â≠ó„ÄÇ');
				//Ê≠•È™§3
				console.log('‰ΩúÊñáÊîπÊàêËøôÊ†∑Â¶Ç‰ΩïÔºüÁúãÁúã‰∏ÄÂÖ±Â§öÂ∞ëÂ≠óÔºåÂ¶ÇÊûú>120Â≠óÔºåËØ∑Á≤æÁÆÄ„ÄÇ‰Ω†ÂÜçÂà§Êñ≠‰∏Ä‰∏ãÊòØÂê¶ÂåÖÂê´‰∫Ü„Äê'+words+'„ÄëÂÖ®ÈÉ®ÂçïËØçÔºåÂ¶ÇÊûúÁº∫Â∞ëÔºåËØ∑Âú®ÈÄÇÂΩìÁöÑ‰ΩçÁΩÆË°•ÂÖÖÔºå‰ΩÜ‰∏çË¶Å‰øÆÊîπÂ§™Â§öÂÜÖÂÆπ„ÄÇ');
			}
			if (pageWords.length === 0) {
				wordContainer.innerHTML = '<div class="no-results">Ê≤°ÊúâÊâæÂà∞ÂåπÈÖçÁöÑÂçïËØç</div>';
				return;
			}
			pageWords.forEach((word, index) => {
				const wordCard = createWordCard(word, startIndex + index + 1);
				wordContainer.appendChild(wordCard);
			});
		}
		function createWordCard(word, index) {
			const wordCard = document.createElement('div');
			const state = wordManager.getWordState(word.W);
			const wordClasses = ['word-card'];
			if (state.isForgotten) wordClasses.push('forget');
			if (state.isLearned) wordClasses.push('learned');
			wordCard.className = wordClasses.join(' ');
			const wordTitle = wordManager.getWordClickTitle(word.W);
			const phoneticTitle = wordManager.getPhoneticClickTitle(word.W, currentFilter);
			const isVerb = originalWordData.dongci.some(verb =>
				//verb.W.toLowerCase() === word.W.toLowerCase()
				verb.W === word.W // ÂÆåÂÖ®ÂåπÈÖçÔºåÂå∫ÂàÜÂ§ßÂ∞èÂÜô ÈÅøÂÖçMay(5Êúà)ÂÖ≥ËÅîÂà∞‰∫Ümay(ÂèØ‰ª•)
			);

			const urlParams = getParamsFromUrl();
			let hightlight=function(word,word2){
				if(urlParams.title)return word;
				return highlightSearchTerms(word,word2);
			}


			let explanationHtml = hightlight(word.C);
			explanationHtml+=word.I?("<i>"+hightlight(word.I)+"</i>"):"";
			if (isVerb) {
				explanationHtml = `<span class="explanation verb-link" title="ÁÇπÂáªÊü•ÁúãÂä®ËØçÂèòÂåñ">${explanationHtml}</i></span>`;
			} else {
				explanationHtml = `<span class="explanation">${explanationHtml}</span>`;
			}
			let frequencyClass = '';
			let frequencyTitle = '';
			switch(word.P) {
				case 1:
					frequencyClass = 'high-frequency';
					frequencyTitle = 'È´òÈ¢ëËØç';
					break;
				case 2:
					frequencyClass = 'medium-frequency';
					frequencyTitle = '‰∏≠È¢ëËØç';
					break;
				case 3:
					frequencyClass = 'low-frequency';
					frequencyTitle = '‰ΩéÈ¢ëËØç';
					break;
			}
			//Ëã±ËØ≠‰æãÂè• - È´ò‰∫Æ
			const englishExamples = word.E.split('/').map(example => example.trim()).filter(example => example);
			let englishExamplesHtml = '';
			englishExamples.forEach((example, i) => {
				const highlightedExample = hightlight(example);
				englishExamplesHtml += `
					<span class="example-english en${englishExamples.length>1?i:''}" data-example="${example}">
						${highlightedExample}
					</span>
				`;
			});
			//‰æãÂè•ÁøªËØë - È´ò‰∫Æ
			const chineseExamples = word.F.split('/').map(example => example.trim()).filter(example => example);
			let chineseExamplesHtml = '<div class="chinesebox">';
			chineseExamples.forEach((example, i) => {
				const highlightedExample = hightlight(example);
				chineseExamplesHtml += `
					<span class="example-chinese en${chineseExamples.length>1?i:''}">${highlightedExample}</span>
				`;
			});
			chineseExamplesHtml += '</div>';
			wordCard.innerHTML = `
				<div class="word-header">
					<div class="word-main">
						<span class="word" title="${wordTitle}">${hightlight(word.W,word.W)}</span>
						<span class="phonetic" title="${phoneticTitle}">${word.Y}</span>
						${explanationHtml}
					</div>
					<button class="audio-btn" title="Êí≠ÊîæÂèëÈü≥" __style="${word.URL ? '' : 'display:none'}">üîä</button>
				</div>
				<div class="example">
					${englishExamplesHtml}
					${chineseExamplesHtml}
				</div>
				<a class="word-index ${frequencyClass}" title="Êü•ÁúãÂçïËØç ${word.W}" href="https://www.iciba.com/word?w=${word.W}" target="_blank">${index}</a>
			`;
			const wordElement = wordCard.querySelector('.word');
			const phoneticElement = wordCard.querySelector('.phonetic');
			const audioBtn = wordCard.querySelector('.audio-btn');
			const explanationElement = wordCard.querySelector('.explanation');
			wordElement.addEventListener('click', () => handleWordClick(word.W, wordElement, 'word'));
			phoneticElement.addEventListener('click', () => handleWordClick(word.W, phoneticElement, 'phonetic'));
			let mp3="http://dict.youdao.com/dictvoice?type=0&audio="+word.W;
			audioBtn.addEventListener('click', () => playAudio(mp3, audioBtn));
			if (isVerb) {
				const verbLink = wordCard.querySelector('.verb-link');
				verbLink.addEventListener('click', (e) => {
					e.stopPropagation();
					verbManager.show(word.W);
				});
			}
			const exampleElements = wordCard.querySelectorAll('.example-english');
			if(isTTSSupported)
			exampleElements.forEach(example => {
				example.style.cursor = 'pointer';
				example.title = 'ÁÇπÂáªÊúóËØªËã±Êñá‰æãÂè•';
				example.addEventListener('click', (e) => {
					e.stopPropagation();
					const englishText = example.getAttribute('data-example');
					if (englishText) {
						speakEnglishExample(englishText, example);
					}
				});
			});
			return wordCard;
		}
		function handleWordClick(word, element, type) {
			const result = wordManager.handleWordClick(word);
			if (result.success) {
				toastManager.show(result.message, result.type, 2000);
				updateWordCardState(word, element.closest('.word-card'), type);
			}
		}
		function updateWordCardState(word, wordCard, type) {
			const state = wordManager.getWordState(word);
			wordCard.classList.remove('forget', 'learned');
			if (state.isForgotten) {
				wordCard.classList.add('forget');
			} else if (state.isLearned) {
				if(type === 'phonetic') {
				} else {
					wordCard.classList.add('learned');
				}
			}
			const wordTitle = wordManager.getWordClickTitle(word);
			const phoneticTitle = wordManager.getPhoneticClickTitle(word, currentFilter);
			const wordElement = wordCard.querySelector('.word');
			const phoneticElement = wordCard.querySelector('.phonetic');
			wordElement.title = wordTitle;
			phoneticElement.title = phoneticTitle;
		}
		function playAudio(audioUrl, button) {
			if (currentAudio) {
				currentAudio.pause();
				const currentBtn = document.querySelector('.audio-btn.playing');
				if (currentBtn) currentBtn.classList.remove('playing');
			}
			currentAudio = new Audio(audioUrl);
			currentAudio.play();

			if (button) {
				button.classList.add('playing');
				currentAudio.onended = () => {
					button.classList.remove('playing');
				};
				currentAudio.onerror = () => {
					button.classList.remove('playing');
				};
			} else {
				currentAudio.onended = () => {
				};
				currentAudio.onerror = () => {
				};
			}
		}
		function highlightSearchTerms(text, word = null) {
			if (!currentSearchQuery || !text) return text;

			const terms = currentSearchQuery.split(',').map(term => term.trim()).filter(term => term);
			if (terms.length === 0) return text;

			let result = text;
			result = result.replace(/[&<>"']/g, function(m) {
				return {'&': '&amp;', '<': '<', '>': '>', '"': '&quot;', "'": '&#039;'}[m];
			});
			terms.forEach(term => {
				if (!term) return;
				const escapedTerm = term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
				let regex;
				if (word && word.toLowerCase() === term.toLowerCase()) {
					regex = new RegExp(`\\b(${escapedTerm})\\b(?![^<]*>|[^<]*<\\/[^>]*>)`, 'gi');
				} else {
					regex = new RegExp(`(${escapedTerm})(?![^<]*>|[^<]*<\\/[^>]*>)`, 'gi');
				}
				result = result.replace(regex, '<span class="highlight">$1</span>');
			});
			result = result.replace(/<i>/g,"<i>").replace(/<\/i>/g,"</i>");
			return result;
		}
		function renderPagination(limit) {
			if(!limit) limit = wordsPerPage;
			const totalPagesForRender = Math.ceil(currentWordData.length / limit);

			pagination.innerHTML = '';
			if (totalPagesForRender <= 1) return;

			const prevBtn = createPageBtn('‰∏ä‰∏ÄÈ°µ', currentPage > 1, () => {
				if (currentPage > 1) {
					essayManager.pauseAudio();
					essayManager.pauseTTS();
					essayManager.resetAudio();
					essayManager.resetTTS();
					essayManager.resetSize();
					currentPage--;
					updateDisplay(limit);
					updateUrlParams();
					window.scrollTo({ top: 0, behavior: 'smooth' });
				}
			});
			pagination.appendChild(prevBtn);

			const maxVisiblePages = 5;
			let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
			let endPage = Math.min(totalPagesForRender, startPage + maxVisiblePages - 1);

			if (endPage - startPage + 1 < maxVisiblePages) {
				startPage = Math.max(1, endPage - maxVisiblePages + 1);
			}

			if (startPage > 1) {
				pagination.appendChild(createPageBtn('1', true, () => goToPage(1, limit)));
				if (startPage > 2) {
					const ellipsis = document.createElement('span');
					ellipsis.className = 'ellipsis';
					ellipsis.textContent = '...';
					pagination.appendChild(ellipsis);
				}
			}

			for (let i = startPage; i <= endPage; i++) {
				const pageBtn = createPageBtn(i.toString(), true, () => goToPage(i, limit));
				if (i === currentPage) pageBtn.classList.add('active');
				pagination.appendChild(pageBtn);
			}

			if (endPage < totalPagesForRender) {
				if (endPage < totalPagesForRender - 1) {
					const ellipsis = document.createElement('span');
					ellipsis.className = 'ellipsis';
					ellipsis.textContent = '...';
					pagination.appendChild(ellipsis);
				}
				pagination.appendChild(createPageBtn(totalPagesForRender.toString(), true, () => goToPage(totalPagesForRender, limit)));
			}

			const nextBtn = createPageBtn('‰∏ã‰∏ÄÈ°µ', currentPage < totalPagesForRender, () => {
				if (currentPage < totalPagesForRender) {
					essayManager.pauseAudio();
					essayManager.pauseTTS();
					essayManager.resetAudio();
					essayManager.resetTTS();
					essayManager.resetSize();
					currentPage++;
					updateDisplay(limit);
					updateUrlParams();
					window.scrollTo({ top: 0, behavior: 'smooth' });
				}
			});
			pagination.appendChild(nextBtn);
		}
		function createPageBtn(text, enabled, onClick) {
			const btn = document.createElement('button');
			btn.className = 'page-btn';
			btn.textContent = text;
			btn.disabled = !enabled;
			if (enabled) btn.addEventListener('click', onClick);
			return btn;
		}
		function goToPage(page, limit) {
			if(!limit) limit = wordsPerPage;
			essayManager.pauseAudio();
			essayManager.pauseTTS();
			essayManager.resetAudio();
			essayManager.resetTTS();
			essayManager.resetSize();
			currentPage = page;
			updateDisplay(limit);
			updateUrlParams();
			essayManager.checkAndShowEssay(currentPage);
			window.scrollTo({ top: 0, behavior: 'smooth' });
		}
		function updatePrintFooter(limit) {
			if(!limit)limit=wordsPerPage;
			const totalWords = currentWordData.length;
			const currentRange = `${(currentPage - 1) * limit + 1}-${Math.min(currentPage * limit, totalWords)}`;
			printFooter.textContent = `Á¨¨ ${currentPage} È°µÔºåÂÖ± ${totalPages} È°µ | ÊòæÁ§∫ÂçïËØç ${currentRange}ÔºåÂÖ± ${totalWords} ‰∏™`;
		}
		function initEventListeners() {
			searchInput.addEventListener('input', debounce(searchWords, 300));
			sortBtn.addEventListener('click', sortWords);
			fuzzySearchCheckbox.addEventListener('change', searchWords);

			filterLinks.forEach(link => {
				link.addEventListener('click', (e) => {
					e.preventDefault();
					const href = link.getAttribute('href');
					const filter = href.includes('filter=') ? href.split('filter=')[1] : 'all';
					currentPage = 1;
					if (filter === 'cache') {
						searchInput.value = '';
						currentSearchQuery = '';
					}

					const urlParams = getParamsFromUrl();
					const hasTitleParam = urlParams.title !== null;

					if (urlParams.title && urlParams.query && window.location.search.includes('fuzzy=')) {

						const newParams = new URLSearchParams();
						if (filter !== 'all') {
							newParams.set('filter', filter);
						}

						const newUrl = `${window.location.pathname}?${newParams.toString()}`;
						window.history.replaceState(null, '', newUrl);



						currentSearchQuery = '';
						searchInput.value = '';
						fuzzySearchCheckbox.checked = true;

						searchInput.readOnly = false;
						searchInput.style.backgroundColor = '';
						searchInput.style.border = '';
						searchInput.style.borderRadius = '';
						searchInput.style.padding = '';
						document.querySelector('.search-box .checkbox').style.display = '';
					}

					applyFilter(filter);
				});
			});
			document.addEventListener('keydown', (e) => {
				if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
					e.preventDefault();
					searchInput.focus();
				}
			});
		}
		function debounce(func, wait) {
			let timeout;
			return function executedFunction(...args) {
				const later = () => {
					clearTimeout(timeout);
					func(...args);
				};
				clearTimeout(timeout);
				timeout = setTimeout(later, wait);
			};
		}

		let readAloudManager = null;
		function initApp() {
			addCacheButtons();
			initUrlParams();
			initEventListeners();
			initKeyboardNavigation();
			applyFilter(currentFilter);
			setTimeout(() => {
				essayManager.checkAndShowEssay(currentPage);
			}, 100);
		}
		initApp();
	</script>
</body>
</html>